---
title: Footprinting
date: 2025-08-25 16:30:00
categories: [CPTS Preparation, Information Gathering]
tags: [Enumeration, Footprinting]     ## TAG names should always be lowercase
---

## **1. Introduction**

## 1.1. Enumeration Principles ‚Äî Structured Learning Summary

#### Reconnaissance vs Enumeration

- **OSINT (Open-Source Intelligence)**
    - Passive only ‚Äî collects information from public/third-party sources (WHOIS, search engines, social media, breach data).
    - Independent from enumeration ‚Äî does not involve direct interaction with the target.
- **Enumeration**
    - Active and semi-active techniques: scanning, banner grabbing, service probing.
    - Iterative loop: each new piece of information informs further enumeration.
    - Targets: domains, IP ranges, services (SSH, RDP, WinRM, HTTP, SMTP, etc.), infrastructure layouts.

**Reasoning Layer:** OSINT provides context without touching the target, while enumeration involves **direct interaction** and is the foundation for exploitation planning. Mixing the two often leads to confusion about legality, scope, and technique.

---

#### Understanding Enumeration

###### Why Enumeration Matters

- Builds a **map of the infrastructure**: services, protocols, communication layers.
- Prevents noisy, blind attacks (e.g., brute-forcing credentials without knowing defenses).
- Focuses on **understanding before attacking** ‚Äî reducing the chance of triggering detection/lockouts.

**Analogy:**
A treasure hunter does not randomly dig; they study maps, prepare tools, and plan the expedition. Similarly, enumeration prepares the penetration tester by mapping what exists and what may be hidden.

---

#### Enumeration Pitfalls

- **Wrong approach:**
    - Immediately brute-forcing services like SSH or RDP.
    - Generates noise, risks detection/blacklisting.
    - Misses deeper insights into **how the infrastructure works**.
- **Right approach:**
    - Study how the company is structured (internal vs external services, vendors, security measures).
    - Look at what‚Äôs **visible** and **not visible** (hidden services, indirect evidence).
    - Form hypotheses, validate with scans, and refine.

**Reasoning Layer:** Enumeration is not about rushing into exploitation but **laying the groundwork** for controlled, informed attacks.

---

#### Enumeration Principles & Guiding Questions

###### Core Principles

| No. | Principle | Description |
| --- | --- | --- |
| 1 | **There is more than meets the eye** | Always consider multiple viewpoints and hidden layers. |
| 2 | **Distinguish between what we see and what we do not see** | Visible data vs invisible but inferable data. |
| 3 | **There are always ways to gain more information** | Continue digging logically; enumeration never ends at the first discovery. |

---

###### Guiding Questions

When enumerating a target, continuously ask:

1. **What can we see?**
2. **Why are we seeing it?** (legit exposure vs misconfig)
3. **What image does this create?** (what picture of the target is emerging?)
4. **What do we gain from it?** (is it useful for exploitation paths?)
5. **How can we use it?** (leverage for pivoting/escalation)
6. **What can we not see?** (hidden systems, filtered ports, masked services)
7. **Why can‚Äôt we see it?** (firewalls, segmentation, obscurity)
8. **What image results from what we do not see?** (inference from absence ‚Äî e.g., missing ports, blocked responses).

**Reasoning Layer:** The questions force testers to look **beyond the obvious** and integrate inference, not just raw scan results.

---

#### Lessons Learned

- Enumeration is a **strategic phase**, not a brute-force phase.
- Focus on **understanding the infrastructure** rather than blindly attacking.
- Always distinguish between **seen and unseen components**.
- Maintain a mindset that **information is iterative** ‚Äî each discovery leads to further hypotheses.
- Penetration testing is not about exploiting first, but about knowing **how systems can be exploited**.

---

#### Summary Table

| Topic | Tools/Techniques | Example | Lessons Learned |
| --- | --- | --- | --- |
| OSINT vs Enumeration | Passive vs Active methods | WHOIS (OSINT), `nmap -sV` (Enumeration) | Keep OSINT separate; OSINT informs enumeration but doesn‚Äôt replace it |
| Understanding Services | Scanning, banner grabbing, protocol analysis | `nmap -p 22,3389 -sV target` | Understand purpose of services before attacking |
| Pitfalls | Brute force, noisy scans | Hydra brute-forcing SSH | Leads to detection/blacklisting, loses stealth |
| Enumeration Principles | Applying guiding questions | ‚ÄúWhat do we not see?‚Äù ‚Üí Filtered ports | Enumeration = iterative discovery, not one-time scan |
| Best Practices | Structured approach, inference, continuous loop | Service mapping, correlating logs & responses | Proper enumeration reveals hidden layers attackers can exploit later |

---

üìå **Tip for Practice:** Write down the principles and guiding questions where you can easily refer to them during labs and real engagements. This ensures you stay in **strategic mode** rather than rushing into noisy attacks.

---

## **1.2.** Enumeration Methodology

#### üìå Overview

- Complex processes like **enumeration** require a standardized methodology.
- Many testers rely on habits/experience, but without structure, this risks gaps and inefficiency.
- Penetration testing is **dynamic**, so we need a **static framework** that allows flexibility.

Enumeration methodology is structured into **3 levels** and **6 layers**.

---

#### üîë Enumeration Levels

1. **Infrastructure-based Enumeration**
2. **Host-based Enumeration**
3. **OS-based Enumeration**

---

![enum-method33.webp](/assets/img/cpts/enum-method33.webp)
_Enumeration levels_

> Note: The components of each layer shown represent the main categories and not a full list of all the components to search for. Additionally, it must be mentioned here that the first and second layer (Internet Presence, Gateway) does not quite apply to the intranet, such as an Active Directory infrastructure. The layers for internal infrastructure will be covered in other modules.
{: .prompt-info }


#### üèõÔ∏è Enumeration Layers

| Layer | Description | Information Categories | Goal |
| --- | --- | --- | --- |
| **1. Internet Presence** | Identify internet-facing presence & external infrastructure | Domains, Subdomains, vHosts, ASN, Netblocks, IPs, Cloud Instances, Security Measures | Find all possible target systems & interfaces |
| **2. Gateway** | Identify protections securing external/internal infra | Firewalls, DMZ, IPS/IDS, EDR, Proxies, NAC, Segmentation, VPN, Cloudflare | Understand defenses & what to watch out for |
| **3. Accessible Services** | Identify externally/internally accessible services | Service type, Functionality, Configuration, Ports, Versions, Interfaces | Understand reason & function of services, how to interact/exploit them |
| **4. Processes** | Internal processes tied to services | PIDs, Processed Data, Tasks, Source, Destination | Understand dependencies & data flow |
| **5. Privileges** | Permissions and privileges tied to services | Groups, Users, Permissions, Restrictions, Environment | Identify overlooked/abusable privileges |
| **6. OS Setup** | Internal OS setup & security posture | OS Type, Patch Level, Config, Environment, Sensitive Files | Assess security management & glean sensitive info |

---

#### üß© Visual Representation (ASCII Flow)

```
  +---------------------+
  |   Internet Presence |
  +---------------------+
             ‚Üì
  +---------------------+
  |       Gateway       |
  +---------------------+
             ‚Üì
  +---------------------+
  | Accessible Services |
  +---------------------+
             ‚Üì
  +---------------------+
  |      Processes      |
  +---------------------+
             ‚Üì
  +---------------------+
  |     Privileges      |
  +---------------------+
             ‚Üì
  +---------------------+
  |      OS Setup       |
  +---------------------+

```

Each **layer = wall** in a labyrinth.

We look for **gaps/vulnerabilities** instead of smashing blindly.

---

#### üß≠ Practical Notes

- **Not all gaps lead inside** ‚Üí time-limited tests mean prioritization is critical.
- **SolarWinds example**: Attackers studied infrastructure for months ‚Üí highlights the need for systematic methodology.
- A methodology **is not** a toolset or cheat sheet.
- Tools differ, but methodology remains the **structured process**.

---

#### ‚úÖ Key Takeaways

- Enumeration methodology is about **systematic discovery**, not exploitation.
- Always consider **all 6 layers**; don‚Äôt get stuck brute-forcing the obvious.
- Flexibility is essential, but structure prevents mistakes.
- Remember: **there is almost always a way in** ‚Äî time and methodology determine whether we find it.

---

## **2. Infrastructure Based Enumeration**

## 2.1. Domain Information

#### Reconnaissance

During the **domain information phase**, the goal is to build a picture of a company‚Äôs online footprint without active interaction. This is crucial in black-box engagements, where only target scope is provided.

- **Principles:**
    - Observe what is **presented** (visible services, domains).
    - Consider what is **not presented** but implied (backend technologies, service dependencies).
    - Take a developer‚Äôs perspective: *what infrastructure is required to run these services?*
- **Approach:**
    - Review the main website to understand company services (e.g., IoT, hosting, IT security).
    - Identify relevant technologies and hosting structures.
    - Use passive information sources to remain hidden (customer-like activity).

---

#### Enumeration

###### SSL Certificate Analysis

- SSL certificates often include multiple **Subject Alternative Names (SANs)**, revealing subdomains.
- Example:
    
    ```
    Valid: May 18, 2021 ‚Äì Apr 6, 2022
    DNS: inlanefreight.htb, www.inlanefreight.htb, support.inlanefreight.htb
    
    ```
    
- Certificate Transparency (CT) logs at [crt.sh](https://crt.sh/) allow subdomain discovery.

###### Certificate Transparency Queries

- Query via browser or command line:
    
    ```bash
    curl -s "<https://crt.sh/?q=inlanefreight.com&output=json>" | jq .
    
    ```
    
- Extract unique subdomains:
    
    ```bash
    curl -s "<https://crt.sh/?q=inlanefreight.com&output=json>" | jq .     | grep name | cut -d":" -f2 | grep -v "CN=" | cut -d'"' -f2     | sort -u
    
    ```
    
- Findings included:
    - `matomo.inlanefreight.com`
    - `smartfactory.inlanefreight.com`
    - `iot.inlanefreight.com`
    - `marina-live.inlanefreight.com`
    - `account.ttn.inlanefreight.com`
    - Many others.

---

###### Host Resolution

- Resolve which subdomains map to internal IPs owned by the company:
    
    ```bash
    for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4;done
    ```
    
- Examples:
    
    ```
    blog.inlanefreight.com      10.129.24.93
    inlanefreight.com           10.129.27.33
    matomo.inlanefreight.com    10.129.127.22
    www.inlanefreight.com       10.129.127.33
    
    ```
    
- Note: Third-party hosted servers (e.g., AWS S3) are out of scope unless permitted.
- Once we see which hosts can be investigated further, we can generate a list of IP addresses with a minor adjustment to the¬†`cut`¬†command and run them through¬†`Shodan`.

---

###### Shodan Lookups

- Automate enumeration against IPs:
    
    ```bash
    for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f4 >> ip-addresses.txt;done
    
    for i in $(cat ip-addresses.txt); do shodan host $i;done
    ```
    
- Example results:
    - **10.129.24.93** ‚Äì Nginx, ports 80/443
    - **10.129.27.33** ‚Äì OpenSSH 7.6p1, Nginx, TLS details
    - **10.129.127.22** ‚Äì Apache HTTPD, multiple services (25, 53, 80, 81, 110, 111, 443, 444)

---

###### DNS Records

- Query full records:
    
    ```bash
    dig any inlanefreight.com
    ```
    
- Key findings:
    - **A Records:** Map subdomains to known IPs.
    - **MX Records:** Email managed by Google (`aspmx.l.google.com`).
    - **NS Records:** Managed by INWX (`ns.inwx.net`, `ns2.inwx.net`).
    - **TXT Records:**
        - `atlassian-domain-verification`
        - `google-site-verification`
        - `logmein-verification-code`
        - `spf1` includes Mailgun, Google, Outlook, Atlassian and additional IPs (`ip4:10.129.24.8`	`ip4:10.129.27.2`	`ip4:10.72.82.106`)

---

#### Insights & Context

- **Atlassian** ‚Üí Internal collaboration/development platform (potential Jira/Confluence exposure).
- **Google Workspace (Gmail)** ‚Üí Email handling; possible GDrive integrations.
- **LogMeIn** ‚Üí Centralized remote access ‚Äì critical if compromised.
- **Mailgun** ‚Üí APIs for email management, potential API exploitation surface.
- **Outlook (O365)** ‚Üí Suggests use of OneDrive/Azure storage (SMB access possible).
- **INWX** ‚Üí Domain registrar/hosting provider. TXT record includes identifiers useful for OSINT.

---

#### Lessons Learned

- Passive recon (certificates, DNS, third-party services) can reveal **internal services, tech stack, and potential attack surfaces** without touching the target directly.
- TXT records often expose **third-party integrations**‚Äîvaluable for identifying dependencies and shadow IT.
- Shodan enrichment provides visibility into **open services and software versions** before active probing.

**Reasoning Layer:**

These lessons reinforce why passive techniques are so valuable: they expand visibility while keeping the tester undetected. Each insight helps plan focused, compliant active testing.

---

#### Summary Table

| Topic | Tools/Techniques Used | Key Commands/Methods | Notable Findings | Lessons Learned |
| --- | --- | --- | --- | --- |
| SSL Certificates | Browser, [crt.sh](https://crt.sh/), curl | `curl ‚Ä¶ [crt.sh](https://crt.sh/) ‚Ä¶` | Certificate Transparency | Subdomains from SAN/CT logs |
| Subdomain Enumeration | [crt.sh](https://crt.sh/), bash parsing | `jq`, `grep`, `sort -u` | unique subdomains | CT logs are rich passive OSINT |
| Host Resolution | host, bash loop | `host $i` | `grep "has address"` | Internal IP mapping |
| Service Enumeration | Shodan | `shodan host <IP>` | OpenSSH, Apache, Nginx, mail services | Early service visibility w/o scanning |
| DNS Records | dig | `dig any domain.com` | MX (Google), TXT (Atlassian, LogMeIn, Mailgun) | TXT records reveal integrations |
| Third-Party Services | Passive OSINT | Review TXT/NS entries | Atlassian, O365, Mailgun, INWX | Dependencies = potential attack vectors |

## 2.2. Cloud Resources & **Company-Hosted Servers**

#### Reconnaissance

Cloud services such as **AWS, GCP, and Azure** are now a core part of many companies‚Äô infrastructure. While these providers secure the underlying infrastructure, misconfigurations by administrators can expose company data and services.

- **Key Risks:**
    - Publicly accessible storage (AWS S3, Azure Blob, GCP Cloud Storage).
    - Sensitive files (documents, code, keys) accessible without authentication.
    - Source code references to cloud-hosted content (e.g., JavaScript, CSS, images).

**Reasoning Layer:**

Cloud adoption increases flexibility and scalability but also enlarges the attack surface. Passive reconnaissance helps identify exposed cloud resources without interacting directly with the company‚Äôs infrastructure.

---

#### Enumeration

###### Subdomain & IP Resolution

Company subdomains resolving to internal and cloud resources:

```bash
for i in $(cat subdomainlist); do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4; done

```

Results:

```
blog.inlanefreight.com        10.129.24.93
inlanefreight.com             10.129.27.33
matomo.inlanefreight.com      10.129.127.22
www.inlanefreight.com         10.129.127.33
s3-website-us-west-2.amazonaws.com 10.129.95.250

```

**Reasoning Layer:**

Resolving subdomains identifies which services are hosted internally versus in the cloud. Spotting entries like `s3-website-us-west-2.amazonaws.com` immediately highlights possible exposed storage.

---

###### Google Dorking for Cloud Assets

- **AWS Search:**
    
    ```
    intext:<company> inurl:amazonaws.com
    ```
    
- **Azure Search:**
    
    ```
    intext:<company> inurl:blob.core.windows.net
    ```
    

Findings included **PDFs, text documents, presentations, and code samples**.

**Reasoning Layer:**

Google Dorks exploit indexed cloud storage, revealing files employees may have unintentionally left public. This provides passive visibility into sensitive company material.

---

###### Source Code Inspection

- Target websites often link to external resources:
    - DNS prefetch and preconnect to `.blob.core.windows.net`.
    - JavaScript, CSS, and images loaded from cloud storage.

**Reasoning Layer:**

Inspecting website source code helps identify storage endpoints and CDN integrations, which may be overlooked in DNS or Google search enumeration.

---

###### Third-Party Recon Tools

- **Domain.Glass**
    - Displays infrastructure details, SSL certificates, DNS names, and security assessments (e.g., Cloudflare ‚ÄúSafe‚Äù rating).
- **GrayHatWarfare**
    - Indexes publicly exposed cloud storage across AWS, Azure, and GCP.
    - Provides filtering by file type, bucket names, and search by company identifiers.

Example findings:

- AWS buckets with file counts: `1`, `73`, `0`.
- Publicly listed files: `id_rsa`, `id_rsa.pub` (SSH private/public keys).

**Reasoning Layer:**

Third-party tools enhance passive enumeration by aggregating data across providers. GrayHatWarfare in particular can uncover exposed buckets that traditional OSINT may miss. Discovering SSH keys demonstrates how misconfigurations can escalate into critical security breaches.

---

#### Exploitation Potential

- Public SSH private keys (`id_rsa`) allow attackers to authenticate without passwords.
- Public file listings (presentations, configs, scripts) may contain:
    - Hardcoded credentials.
    - Internal documentation.
    - API keys or secrets.

**Reasoning Layer:**

While not actively exploited during reconnaissance, these findings outline direct exploitation opportunities. Exposed SSH keys represent a **full compromise vector** if linked to valid systems.

---

#### Lessons Learned

- Cloud resource misconfigurations (e.g., public S3 buckets) are a **common attack vector**.
- Google Dorks and tools like GrayHatWarfare provide **low-effort, high-value OSINT**.
- Source code inspection can reveal hidden integrations with cloud storage.
- Leaked credentials or SSH keys drastically lower the barrier to full compromise.
- Companies should implement **strict IAM policies, bucket access controls, and key management**.

**Reasoning Layer:**

Cloud security is as much about configuration and governance as it is about the provider‚Äôs infrastructure. These findings reinforce why penetration testers must always check for misconfigured storage as part of standard recon.

---

#### Summary Table

| Topic | Tools/Techniques Used | Key Commands/Methods | Notable Findings | Lessons Learned |
| --- | --- | --- | --- | --- |
| Subdomain Resolution | host, bash loop | `host $i` with filter | S3 subdomain in DNS | Cloud storage often tied to DNS |
| Google Dorking | Google search | `intext:company inurl:amazonaws.com` | Indexed PDFs, docs | Search engines reveal exposed storage |
| Source Code Review | Browser DevTools | Inspect `<link>` and `<script>` | Azure Blob references | Web source reveals cloud dependencies |
| Domain.Glass | OSINT tool | Domain status page | Cloudflare protection status | Confirms use of security layers |
| GrayHatWarfare | Bucket search engine | Search company/bucket names | Public buckets, SSH keys | Misconfigurations expose critical assets |
| Exploitation Risk | Manual analysis | Review leaked files | `id_rsa` private key | Public keys can enable direct compromise |

---

## 2.3. Staff OSINT

#### Social Media & Employee Recon

- Employees on platforms like LinkedIn/Xing reveal infrastructure & technology stack.
- Job postings show required skills ‚Üí hints at used tools/tech.
- Employee posts and shared content show current focus areas.

---

#### LinkedIn - Job Post (Example)

```markdown
**Required Skills/Knowledge/Experience:**

- 3‚Äì10+ yrs software dev exp
- TS/SCI Security Clearance eligibility
- Degree in CS/CE/Math/related
- Object-Oriented Languages: Java, C##, C++
- Scripting Languages: Python, Ruby, PHP, Perl
- Databases: PostgreSQL, MySQL, SQL Server, Oracle
- ORM Frameworks: SQLAlchemy, Hibernate, Entity Framework
- Web Frameworks: Flask, Django, Spring, [ASP.NET](https://dotnet.microsoft.com/en-us/apps/aspnet) MVC
- Unit Testing: pytest, JUnit, NUnit, xUnit
- SOA/Microservices & RESTful API design
- Agile & Continuous Integration
- Version Control: Git, SVN, Mercurial, Perforce

**Desired Skills:**

- Security+ certification
- Atlassian suite (Confluence, Jira, Bitbucket)
- Algorithm Dev (e.g., Image Processing)
- Software Security
- Docker, Kubernetes
- Redis, NumPy

**Inference:**

- Tech stack: Java, C##, C++, Python, Ruby, PHP, Perl
- DBs: PostgreSQL, MySQL, Oracle
- Frameworks: Flask, Django, [ASP.NET](https://dotnet.microsoft.com/en-us/apps/aspnet), Spring
- Tools: Git, SVN, Perforce, Atlassian suite
- Focus on microservices, APIs, Agile, CI/CD
```

---

#### LinkedIn - Employee ##1 About

- Mentions: W3C specs, Web Components, React, Svelte, AngularJS
- GitHub link to OSS projects

**Risk Example:**

- OWASP Top10 for Django repo ‚Üí hints at common misconfigs
- Some files show personal email + hardcoded JWT

**PoC Snippets (from description):**

```json
{
  "name": "Example Name",
  "author": "Example Author",
  "email": "example@email.com",
  "github": "<https://github.com/example/repo>"
}

```

```python
def decode_jwt(payload, secret, jwt_token):
    ## JWT token redacted
    ## Example function logic
    pass

```

---

#### LinkedIn - Employee ##2 Career

- Roles: VP Software Engineer, Associate Software Engineer
- Work: CRM mobile app, BrokerVotes system
- Skills: Java, React, Slang, Elastic, Kafka

---

#### OSINT Strategy Notes

- LinkedIn advanced search allows filtering by role, tech, security staff.
- Security staff reveal org‚Äôs defensive posture.
- Employee profiles + job posts = map of infra, tools, security measures.

---

## 3. Host Based Enumeration

## 3.1 FTP

A structured knowledge summary covering FTP and TFTP reconnaissance, enumeration, exploitation, and analysis. Includes annotated commands, outputs, and reasoning layers.

---

#### Reconnaissance & Service Discovery

###### Identify FTP/TFTP Services

```bash
nmap -p21,69 -sV -sC -A 10.129.14.136
```

- **FTP (21/tcp)** ‚Üí often misconfigured with anonymous access.
- **TFTP (69/udp)** ‚Üí trivial file transfer, no authentication.

**Reasoning Layer:**
Initial reconnaissance identifies exposed services and versions. FTP/TFTP are known for weak authentication and misconfigurations, making them prime attack vectors.

---

#### Anonymous FTP Login & Manual Enumeration

###### Connect to FTP

```bash
ftp 10.129.14.136
Name: anonymous
Password: anonymous
```

###### Common FTP Commands

| Command | Description |
| --- | --- |
| `ls` | List directory contents |
| `cd` | Change directory |
| `get` | Download file |
| `put` | Upload file |
| `mget *` | Download multiple files |

**Reasoning Layer:**
Testing for anonymous login is a standard step; many FTP servers still allow it for ‚Äúpublic‚Äù file access, often exposing sensitive data.

---

#### Recursive Download with `wget`

###### Mirror Entire FTP Share

```bash
wget -m --no-passive <ftp://anonymous:anonymous@10.129.14.136>
```

Output shows recursive download of all files.
The tool creates a directory named after the target IP:

```bash
tree .
.
‚îî‚îÄ‚îÄ 10.129.14.136
    ‚îú‚îÄ‚îÄ Calendar.pptx
    ‚îú‚îÄ‚îÄ Clients
    ‚îÇ   ‚îî‚îÄ‚îÄ Inlanefreight
    ‚îÇ       ‚îú‚îÄ‚îÄ appointments.xlsx
    ‚îÇ       ‚îú‚îÄ‚îÄ contract.docx
    ‚îÇ       ‚îú‚îÄ‚îÄ meetings.txt
    ‚îÇ       ‚îî‚îÄ‚îÄ proposal.pptx
    ‚îú‚îÄ‚îÄ Documents
    ‚îÇ   ‚îú‚îÄ‚îÄ appointments-template.xlsx
    ‚îÇ   ‚îú‚îÄ‚îÄ contract-template.docx
    ‚îÇ   ‚îî‚îÄ‚îÄ contract-template.pdf
    ‚îú‚îÄ‚îÄ Employees
    ‚îî‚îÄ‚îÄ Important Notes.txt

```

**Reasoning Layer:**`wget -m` is efficient for downloading entire directory structures instead of manual single-file grabs, ensuring no data is missed during enumeration.

---

#### Upload File to FTP Server

###### Create Test File & Upload

```bash
touch testupload.txt
ftp> put testupload.txt
```

Result:

```
226 Transfer complete.
```

Confirm with `ls`:

```
-rw-------    1 1002     133    0 Sep 15 14:57 testupload.txt
```

**Reasoning Layer:**
Testing upload is crucial. If uploads are allowed in a web-accessible directory, this could lead to webshells or direct server compromise.

---

#### Automated Enumeration with Nmap & NSE

###### Update NSE Script Database

```bash
sudo nmap --script-updatedb
```

###### Locate FTP Scripts

```bash
find / -type f -name ftp* 2>/dev/null | grep scripts
```

Common scripts:

- `ftp-anon.nse`
- `ftp-syst.nse`
- `ftp-brute.nse`
- `ftp-vsftpd-backdoor.nse`

###### Run Scan with Scripts

```bash
sudo nmap -sV -p21 -sC -A 10.129.14.136
```

Sample Output:

```
21/tcp open  ftp  vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| -rwxrwxrwx Calendar.pptx [NSE: writeable]
| drwxrwxrwx Clients [NSE: writeable]
...
| ftp-syst:
|   STAT:
|   vsFTPd 3.0.3 - secure, fast, stable
```

**Reasoning Layer:**
Nmap NSE automates service fingerprinting and misconfiguration checks. Scripts like `ftp-anon` and `ftp-syst` quickly reveal anonymous access and server version.

---

#### Script Tracing

###### Trace NSE Execution

```bash
sudo nmap -sV -p21 -sC -A 10.129.14.136 --script-trace
```

Shows NSE script network-level interactions (`CONNECT`, `STAT`, etc.).

**Reasoning Layer:**
Script tracing verifies what commands are being sent. Useful for debugging scans or understanding how automation interacts with services.

---

#### Manual Service Interaction

###### Plaintext

```bash
nc -nv 10.129.14.136 21
telnet 10.129.14.136 21
```

###### Encrypted (TLS/SSL)

```bash
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

Sample Certificate Info:

```
CN = master.inlanefreight.htb
O = Inlanefreight
OU = Dev
emailAddress = admin@inlanefreight.htb
```

**Reasoning Layer:**
Direct interaction allows banner grabbing and testing of commands. SSL/TLS certificates can leak hostnames, org details, and even emails ‚Äî valuable OSINT data.

---

#### TFTP Enumeration

###### Download a File

```bash
tftp 10.129.14.136
tftp> get Important.txt

```

###### Upload a File

```bash
tftp> put shell.php

```

**Reasoning Layer:**
TFTP has no authentication, so file upload/download is often unrestricted. Misconfigured TFTP servers connected to web roots or configs can enable compromise.

---

#### Security Misconfigurations Identified

| Issue | Description | Impact |
| --- | --- | --- |
| Anonymous FTP login | Public access without credentials | Unauthorized data access |
| Recursive read | Full directory traversal | Data leakage |
| Write permissions | Upload possible in multiple dirs | Potential RCE / persistence |
| Plaintext communication | No encryption | Credential theft via sniffing |
| Self-signed TLS cert | Reveals internal hostnames/emails | OSINT / phishing leverage |

**Reasoning Layer:**
Summarizing misconfigurations highlights attack paths and remediation priorities.

---

#### Lessons Learned

- **FTP & TFTP are insecure by design** ‚Üí prefer SFTP/FTPS.
- **Misconfigurations (anon login, write perms)** are common and high-risk.
- **Automation (wget, NSE)** saves time and ensures coverage.
- **Certificates and banners** leak valuable intel.
- **Upload checks** are critical for identifying pivot opportunities.

---

#### üìå Quick Reference Commands

| Purpose | Command |
| --- | --- |
| Mirror FTP site | `wget -m --no-passive <ftp://anonymous:anonymous@IP`> |
| Upload file FTP | `ftp> put file.txt` |
| Download file FTP | `ftp> get file.txt` |
| Download file TFTP | `tftp> get file.txt` |
| Upload file TFTP | `tftp> put file.txt` |
| Nmap NSE FTP scan | `nmap -sV -p21 -sC -A IP` |
| Trace NSE | `nmap --script-trace -p21 -sC -A IP` |
| SSL handshake | `openssl s_client -connect IP:21 -starttls ftp` |

---

## 3.2. SMB & Samba

#### Overview of SMB

- **Server Message Block (SMB)**: Protocol for sharing files, directories, and network resources.
- Used in **Windows OS**, with **downward compatibility**.
- **Samba**: Open-source SMB implementation for Linux/Unix (supports SMB/CIFS).

###### Protocol & Connections

- SMB runs on **TCP** (3-way handshake).
- ACLs control permissions (read, write, execute).
- Shares = Arbitrary parts of filesystem exposed to clients.

---

#### Samba (SMB Dialect)

- Implements **CIFS (SMB v1 dialect)**.
- Ports:
    - **137,138,139** (NetBIOS over TCP/IP)
    - **445** (Direct SMB/CIFS)
- **SMB Versions:**
    - **CIFS / SMB 1.0**: Legacy, insecure.
    - **SMB 2.0 / 2.1**: Performance, caching, locking.
    - **SMB 3.0 / 3.1.1**: Encryption, integrity, AD integration.

###### Samba Daemons

- `smbd` ‚Üí Core SMB server daemon.
- `nmbd` ‚Üí NetBIOS daemon.
- Can act as **AD member** (v3) or **AD Domain Controller** (v4).

###### Workgroups & NetBIOS

- Workgroup = Collection of hosts/resources.
- NetBIOS handles **name registration** (via WINS).

---

#### Samba Configuration

- Config file: `/etc/samba/smb.conf`

###### Example Default Config

```
[global]
   workgroup = DEV.INFREIGHT.HTB
   server string = DEVSMB
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   server role = standalone server
   map to guest = bad user
   usershare allow guests = yes

[printers]
   path = /var/spool/samba
   printable = yes
   read only = yes

[print$]
   path = /var/lib/samba/printers
   read only = yes

```

###### Important Settings

- `workgroup` ‚Üí Domain/workgroup name.
- `path` ‚Üí Directory exposed.
- `map to guest = bad user` ‚Üí Redirect invalid users to guest.
- `guest ok = yes` ‚Üí Allows anonymous access.
- `browseable = yes` ‚Üí Makes share visible in list.
- `read only = no` / `writable = yes` ‚Üí File modification.
- `create mask` & `directory mask` ‚Üí File/dir permission defaults.

---

#### Dangerous Settings

- `browseable = yes` ‚Üí Attackers can list shares.
- `guest ok = yes` ‚Üí No password required.
- `writable = yes` ‚Üí File modification possible.
- `create mask = 0777` / `directory mask = 0777` ‚Üí Full access for all.

###### Example Insecure Share

```
[notes]
   comment = CheckIT
   path = /mnt/notes/
   browseable = yes
   read only = no
   writable = yes
   guest ok = yes
   enable privileges = yes
   create mask = 0777
   directory mask = 0777

```

---

#### Enumeration & Exploitation

###### Restart Samba

```bash
sudo systemctl restart smbd

```

###### SMBclient (Null Session / Anonymous)

```bash
smbclient -N -L //10.129.14.128

```

- Lists shares (default: `print$`, `IPC$`).

###### Connect to Share

```bash
smbclient //10.129.14.128/notes

```

- Anonymous login possible if `guest ok = yes`.

###### Useful smbclient Commands

- `ls` ‚Üí List files
- `get <file>` ‚Üí Download file
- `!<cmd>` ‚Üí Run local command

Example:

```bash
smb: \\> get prep-prod.txt
smb: \\> !cat prep-prod.txt

```

---

#### Admin Monitoring

```bash
smbstatus

```

- Shows active users, shares, and protocols.

---

#### Nmap Enumeration

```bash
sudo nmap 10.129.14.128 -sV -sC -p139,445

```

- Detects SMB version, signing, time.
- Limited ‚Üí use with manual tools.

---

#### Rpcclient (Manual Enumeration)

```bash
rpcclient -U "" 10.129.14.128

```

###### Rpcclient Commands

- `srvinfo` ‚Üí Server info
- `enumdomains` ‚Üí List domains
- `querydominfo` ‚Üí Domain & user info
- `netshareenumall` ‚Üí Enumerate shares
- `netsharegetinfo <share>` ‚Üí Share details
- `enumdomusers` ‚Üí List users
- `queryuser <RID>` ‚Üí User details

---

## Part 2 ‚Äì User & Group Enumeration

#### Rpcclient ‚Äì User Enumeration

```bash
rpcclient $> enumdomusers

```

- Example output:
    - `mrb3n` (RID: 0x3e8)
    - `cry0l1t3` (RID: 0x3e9)

###### Query User Details

```bash
rpcclient $> queryuser 0x3e9
rpcclient $> queryuser 0x3e8

```

---

#### Rpcclient ‚Äì Group Information

```bash
rpcclient $> querygroup 0x201

```

- Group: Ordinary Users (2 members).

---

#### RID Brute Forcing

```bash
for i in $(seq 500 1100); do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x' $i)" | grep "User Name\\|user_rid\\|group_rid" && echo "";done

```

- Discovered:
    - `sambauser` (RID: 0x1f5)
    - `mrb3n` (RID: 0x3e8)
    - `cry0l1t3` (RID: 0x3e9)

---

#### Impacket ‚Äì [samrdump.py](https://wadcoms.github.io/wadcoms/Impacket-SAMRDump/)

```bash
samrdump.py 10.129.14.128

```

- Enumerates domain users & attributes.
- Discovered: `mrb3n`, `cry0l1t3`.

---

#### SMBmap

```bash
smbmap -H 10.129.14.128

```

- Lists shares & permissions.

---

#### CrackMapExec

```bash
crackmapexec smb 10.129.14.128 --shares -u '' -p ''

```

- Detects OS version, enumerates shares & perms.
- Example: `notes` ‚Üí READ,WRITE.

---

#### Enum4Linux-ng

```bash
git clone <https://github.com/cddmp/enum4linux-ng.git>
cd enum4linux-ng
pip3 install -r requirements.txt
./enum4linux-ng.py 10.129.14.128 -A

```

- Automated enumeration.

###### Findings:

- Workgroup: `DEVOPS`
- Server: `DEVSMB`
- SMB Versions: 2.02, 2.1, 3.0 (SMB1 disabled)
- Users: `mrb3n`, `cry0l1t3`
- Shares: `notes`, `home`, `dev`, `print$`, `IPC$`
- Password Policy: Min length = 5, Complexity = disabled
- OS: Windows 7 / Server 2008 R2

---

#### Key Takeaways

- Null sessions are a major risk.
- Manual enumeration (`rpcclient`) + automated tools (SMBmap, CME, enum4linux-ng) give best coverage.
- Weak configs (`guest ok`, `writable`, `browseable`) lead to exploitation.

#### POC Questions (SMB)

1. What version of the SMB server is running on the target system? Submit the entire banner as the answer.

```bash
sudo nmap 10.129.57.34 -sV -sC -p137,138,139,445
```

Samba smbd 4.6.2

1. What is the name of the accessible share on the target?

```bash
smbmap -H 10.129.57.34
##or
crackmapexec smb 10.129.57.34 --shares -u '' -p ''
smbclient -N -L [//10.129.57.34](https://10.129.57.34/)
```

sambashare

1. Connect to the discovered share and find the flag.txt file. Submit the contents as the answer.

```bash
smbclient [//10.129.57.34/sambashare](https://10.129.57.34/sambashare)
smb: \> ls
.                                   D        0  Mon Nov  8 07:43:14 2021
..                                  D        0  Mon Nov  8 09:53:19 2021
.profile                            H      807  Tue Feb 25 06:03:22 2020
contents                            D        0  Mon Nov  8 07:43:45 2021
.bash_logout                        H      220  Tue Feb 25 06:03:22 2020
.bashrc                             H     3771  Tue Feb 25 06:03:22 2020
	4062912 blocks of size 1024. 414240 blocks available
	
smb: \> get contents
NT_STATUS_FILE_IS_A_DIRECTORY opening remote file \contents
smb: \> cd contents
smb: \contents\> ls
.                                   D        0  Mon Nov  8 07:43:45 2021
..                                  D        0  Mon Nov  8 07:43:14 2021
flag.txt                            N       38  Mon Nov  8 07:43:45 2021
	4062912 blocks of size 1024. 414236 blocks available
	
smb: \contents\> get flag.txt
getting file \contents\flag.txt of size 38 as flag.txt (1.9 KiloBytes/sec) (average 1.9 KiloBytes/sec)
smb: \contents\> !cat flag.txt
HTB{o873nz4xdo873n4zo873zn4fksuhldsf}
```

HTB{o873nz4xdo873n4zo873zn4fksuhldsf}

1.  Find out which domain the server belongs to.

```bash
enum4linux-ng 10.129.57.34 -A
```

DEVOPS

1. Find additional information about the specific share we found previously and submit the customized version of that specific share as the answer.

```bash
netsharegetinfo sambashare
```

InFreight SMB v3.1

1. What is the full system path of that specific share? (format: "/directory/names")

```bash
netsharegetinfo sambashare
```

/home/sambauser

## 3.3. NFS

#### Overview - NFS (Network File System)

- Developed by **Sun Microsystems**.
- Similar purpose to SMB: network file access as if local.
- Used mainly between **Linux/Unix systems** (incompatible with SMB).
- Based on **ONC-RPC/SUN-RPC** over TCP/UDP port **111**.
- NFS service runs on **port 2049**.

###### Versions

| Version | Features |
| --- | --- |
| **NFSv2** | Legacy, UDP only. |
| **NFSv3** | Variable file size, better error reporting, not fully compatible with v2. |
| **NFSv4** | Kerberos auth, firewall-friendly, ACLs, stateful, secure, single port (2049). |
| **NFSv4.1** | Cluster support, pNFS (parallel access), multipathing, session trunking. |

---

#### Authentication & Authorization

- Authentication handled by **RPC protocol**, not NFS itself.
- Authorization based on **file system UID/GID mappings**.
- **Common issue:** client/server may map UIDs/GIDs differently ‚Üí privilege mismatch.
- **NFSv3**: client machine authentication.
- **NFSv4**: user authentication required.
- **Security concern:** should only be used in **trusted networks**.

---

#### Configuration

- Config file: **`/etc/exports`**
- Example:

```bash
/srv/homes   host1(rw,sync,no_subtree_check) host2(ro,sync,no_subtree_check)
/srv/nfs4    gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)

```

###### Export Options

| Option | Description |
| --- | --- |
| rw | Read/write access |
| ro | Read-only |
| sync | Sync transfer (safer, slower) |
| async | Async transfer (faster, less safe) |
| secure | Restrict to ports <1024 |
| insecure | Allow ports >1024 |
| no\_subtree\_check | Skip subdirectory checks |
| root\_squash | Map root ‚Üí anonymous UID/GID (prevents root abuse) |

---

#### ExportFS Example

```bash
echo '/mnt/nfs 10.129.14.0/24(sync,no_subtree_check)' >> /etc/exports
systemctl restart nfs-kernel-server
exportfs

```

---

#### Dangerous Settings

| Option | Risk |
| --- | --- |
| rw | Full modification possible |
| insecure | Non-root users can bind to high ports |
| nohide | Nested mounts exposed |
| no\_root\_squash | Remote root keeps UID=0 (major security risk) |

---

#### Enumeration & Exploitation

###### Nmap Scanning

```bash
sudo nmap 10.129.14.128 -p111,2049 -sV -sC

```

- Detects **rpcbind**, **nfs**, **mountd**, **nlockmgr**.

```bash
sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049

```

- Runs **NFS NSE scripts**:
    - `nfs-ls` ‚Üí Lists files
    - `nfs-showmount` ‚Üí Show exported shares
    - `nfs-statfs` ‚Üí Filesystem stats

---

###### Show Available Shares

```bash
showmount -e 10.129.14.128

```

---

###### Mounting Shares

```bash
mkdir target-NFS
sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
cd target-NFS
tree .

```

---

###### Listing Contents

With usernames:

```bash
ls -l mnt/nfs/

```

With UIDs:

```bash
ls -n mnt/nfs/

```

---

###### Privilege Escalation via NFS

- If `no_root_squash` enabled ‚Üí remote root can create SUID binaries.
- Steps:
    1. Compile a SUID shell locally.
    2. Upload to NFS share.
    3. Execute on target ‚Üí root shell.

---

###### Unmounting

```bash
cd ..
sudo umount ./target-NFS

```

---

#### Key Takeaways

- NFS should not be exposed to untrusted networks.
- Dangerous options (`rw`, `insecure`, `no_root_squash`) = severe risks.
- Enumeration: **nmap NSE**, **showmount**, **manual mounting**.
- Exploitation: **UID/GID mapping abuse** + **SUID escalation**.

---

## 3.4. DNS

#### Overview

- DNS resolves domain names (e.g., [academy.hackthebox.com](https://academy.hackthebox.com/)) to IP addresses.
- Distributed system (no central DB). Think of many phone books (many name servers).
- Globally distributed DNS servers translate domain names ‚Üí IP and control target servers.
- DNS can store additional service info (mail servers, nameservers, TXT records, etc).
- Default DNS is unencrypted; privacy risks. Common encryptions:
    - DNS over TLS (DoT)
    - DNS over HTTPS (DoH)
    - DNSCrypt

#### DNS Server Types (brief)

- **DNS Root Server**: Top-level domains (TLD). 13 root servers. Coordinated by ICANN.
- **Authoritative nameserver**: Holds zone authority; authoritative answers for its zone.
- **Non-authoritative nameserver**: Not responsible ‚Äî collects info via recursion/iteration.
- **Caching DNS Server**: Caches responses for TTL-specified duration.
- **Forwarding Server**: Forwards DNS queries to another server.
- **Resolver**: Local resolver on client/router ‚Äî not authoritative.

![image.png](/assets/img/footprinting/image.png)

#### Common DNS Record Types

- **A**: IPv4 address.
- **AAAA**: IPv6 address.
- **MX**: Mail servers.
- **NS**: Nameservers for the domain.
- **TXT**: Arbitrary text (SPF, DMARC, verification codes).
- **CNAME**: Alias to another domain.
- **PTR**: Reverse lookup: IP ‚Üí domain.
- **SOA**: Zone authority + admin email + timing parameters (serial, refresh, retry, expire, minimum).

#### BIND9 configuration files (Linux)

- `named.conf` split: options (global) and zone entries.
- Local config files commonly:
    - `/etc/bind/named.conf.local`
    - `/etc/bind/named.conf.options`
    - `/etc/bind/named.conf.log`
- Global options affect all zones; zone options override globals.

###### Example `named.conf.local`

```
//
// Do any local configuration here
//
zone "domain.com" {
    type master;
    file "/etc/bind/db.domain.com";
    allow-update { key rndc-key; };
};

```

#### Zone file (forward) example (`/etc/bind/db.domain.com`)

```
$ORIGIN domain.com
$TTL 86400
@     IN     SOA    dns1.domain.com.     hostmaster.domain.com. (
                    2001062501 ; serial
                    21600      ; refresh after 6 hours
                    3600       ; retry after 1 hour
                    604800     ; expire after 1 week
                    86400 )    ; minimum TTL of 1 day

      IN     NS     ns1.domain.com.
      IN     NS     ns2.domain.com.

      IN     MX     10     mx.domain.com.
      IN     MX     20     mx2.domain.com.

             IN     A       10.129.14.5

server1      IN     A       10.129.14.5
server2      IN     A       10.129.14.7
ns1          IN     A       10.129.14.2
ns2          IN     A       10.129.14.3

ftp          IN     CNAME   server1
mx           IN     CNAME   server1
mx2          IN     CNAME   server2
www          IN     CNAME   server2

```

#### Reverse zone example (`/etc/bind/db.10.129.14`)

```
$ORIGIN 14.129.10.in-addr.arpa
$TTL 86400
@     IN     SOA    dns1.domain.com.     hostmaster.domain.com. (
                    2001062501 ; serial
                    21600
                    3600
                    604800
                    86400 )

      IN     NS     ns1.domain.com.
      IN     NS     ns2.domain.com.

5    IN     PTR    server1.domain.com.
7    IN     MX     mx.domain.com.

```

#### Dangerous / commonly misconfigured options (security impact)

- `allow-query`: which hosts may query the server.
- `allow-recursion`: which hosts may send recursive queries.
- `allow-transfer`: which hosts can receive zone transfers (AXFR).
- `zone-statistics`: may expose data.
- Misconfiguration (e.g., allow-transfer to `any`, or open recursion) can leak internal hosts, enable amplification, etc.

#### Footprinting & Recon techniques (PoC commands)

- Query nameservers (NS record):

```bash
dig ns inlanefreight.htb @10.129.14.128

```

- Query BIND version (CHAOS class TXT):

```bash
dig CH TXT version.bind @10.129.120.85
## or
dig CH TXT version.bind

```

- ANY query (note: servers may not return full zone):

```bash
dig any inlanefreight.htb @10.129.14.128

```

- AXFR zone transfer (over TCP/53):

```bash
dig axfr inlanefreight.htb @10.129.14.128

```

- AXFR can disclose internal zones if `allow-transfer` is too permissive:

```bash
dig axfr internal.inlanefreight.htb @10.129.14.128

```

- Subdomain brute-force using wordlist + `dig` loop (example):

```bash
for sub in $(cat /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt); do dig $sub.inlanefreight.htb @10.129.14.128 | grep -v ';\\|SOA' | sed -r '/^\\s*$/d' | grep $sub | tee -a subdomains.txt; done

```

- Example using `dnsenum`:

```bash
dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb

```

#### Zone transfer / primary-secondary model notes

- Primary (master): original zone data; admins edit here.
- Secondary (slave): fetches SOA from master at refresh interval and compares serial numbers ‚Üí if master's serial higher, slave initiates transfer.
- Zone transfers usually via AXFR (TCP 53).

#### Practical tips / takeaways

- Always restrict `allow-transfer` to authorized IPs (avoid `any`).
- Restrict recursion (`allow-recursion`) to internal resolvers only.
- Do not expose BIND version (disable version in CHAOS).
- Use DNSSEC and DNS encryption (DoH/DoT) where appropriate for integrity/privacy.
- Monitor zone statistics and audit `named.conf` for weak settings.
- Use strong rndc keys for server synchronization.
- Use subdomain enumeration and AXFR checks during security assessments; they can disclose internal hosts and services.

#### Example dig output snippets (representative)

- SOA query:

```
inlanefreight.com.      900     IN      SOA     ns-161.awsdns-20.com. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400
## Note: dot in email ‚Üí awsdns-hostmaster@amazon.com

```

- ANY query excerpt (shows TXT/SPF, NS, SOA):

```
inlanefreight.htb.      604800  IN      TXT     "v=spf1 include:mailgun.org include:_spf.google.com include:spf.protection.outlook.com include:_spf.atlassian.net ip4:10.129.124.8 ip4:10.129.127.2 ip4:10.129.42.106 ~all"
inlanefreight.htb.      604800  IN      SOA     inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
inlanefreight.htb.      604800  IN      NS      ns.inlanefreight.htb.
ns.inlanefreight.htb.   604800  IN      A       10.129.34.136

```

#### References (from notes)

- CVE/BIND vulnerabilities (e.g., CVEdetails) ‚Üí https://www.cvedetails.com/product/144/ISC-Bind.html?vendor_id=64
- SecurityTrails list of popular DNS attacks ‚Üí https://web.archive.org/web/20250329174745/https://securitytrails.com/blog/most-popular-types-dns-attacks

---

## 3.5. SMTP

#### Overview

- SMTP = Simple Mail Transfer Protocol: protocol for sending email over IP networks.
- Used between MUA (client) and outgoing mail server, or between two SMTP servers (server can act as client).
- Commonly paired with IMAP/POP3 for fetching mail.
- Default port: **25**. Other common ports:
    - **587**: Mail submission from authenticated users; often uses STARTTLS to upgrade to TLS.
    - **465**: Historically used for SMTPS (implicit TLS).
- SMTP is plaintext by default; use SSL/TLS (STARTTLS or implicit TLS) to encrypt commands/authentication.

#### Authentication & Extensions

- ESMTP (Extended SMTP) is widely used; adds SMTP-Auth for authentication.
- Common authentication: `AUTH PLAIN` (must be used over encrypted channel for security).
- STARTTLS issued after `EHLO` to switch to TLS.
- Security mechanisms to prevent abuse: SPF, DKIM, DMARC, and spam filtering/quarantine.

#### Mail Transfer Architecture

- MUA (Mail User Agent) -> MSA (Mail Submission Agent / Relay) -> MTA (Mail Transfer Agent) -> MDA (Mail Delivery Agent) -> Mailbox (POP3/IMAP).
- MSA may check origin/validity; misconfiguration can lead to open relay vulnerabilities.
- MTA checks size/spam, stores and relays; MDA delivers to recipient mailbox.

#### SMTP Commands (common)

- `HELO` / `EHLO` ‚Äî client introduces itself (EHLO for ESMTP).
- `MAIL FROM:` ‚Äî specify sender.
- `RCPT TO:` ‚Äî specify recipient.
- `DATA` ‚Äî begin email content; terminate with `\r\n.\r\n`.
- `AUTH PLAIN` ‚Äî authenticate.
- `VRFY` ‚Äî verify mailbox existence.
- `EXPN` ‚Äî expand mailing lists.
- `RSET` ‚Äî reset current mail transaction.
- `NOOP` ‚Äî no operation (keeps connection alive).
- `QUIT` ‚Äî terminate session.

#### Behavior & Limitations

- SMTP lacks a standardized, machine-usable delivery confirmation; DSNs exist but vary.
- Connections by default do not authenticate the user; sender addresses can be spoofed.
- Open relays enable spam distribution and spoofing.
- Admin misconfiguration example: `mynetworks = 0.0.0.0/0` -> allows relaying for any IP.

#### Default Postfix Configuration (example)

```bash
J0n4ss@htb[/htb]$ cat /etc/postfix/main.cf | grep -v "##" | sed -r "/^\s*$/d"

smtpd_banner = ESMTP Server
biff = no
append_dot_mydomain = no
readme_directory = no
compatibility_level = 2
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache
myhostname = mail1.inlanefreight.htb
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
smtp_generic_maps = hash:/etc/postfix/generic
mydestination = $myhostname, localhost
masquerade_domains = $myhostname
mynetworks = 127.0.0.0/8 10.129.0.0/16
mailbox_size_limit = 0
recipient_delimiter = +
smtp_bind_address = 0.0.0.0
inet_protocols = ipv4
smtpd_helo_restrictions = reject_invalid_hostname
home_mailbox = /home/postfix

```

- Note: `mynetworks` should be restricted to trusted ranges; overly broad ranges cause open-relay risk.

#### Telnet Interaction Examples (PoC)

- Open TCP connection to port 25:

```bash
$ telnet 10.129.14.128 25
Trying 10.129.14.128...
Connected to 10.129.14.128.
220 ESMTP Server

```

- HELO / EHLO:

```bash
HELO mail1.inlanefreight.htb
250 mail1.inlanefreight.htb

EHLO mail1
250-mail1.inlanefreight.htb
250-PIPELINING
250-SIZE 10240000
250-ETRN
250-ENHANCEDSTATUSCODES
250-8BITMIME
250-DSN
250-SMTPUTF8
250 CHUNKING

```

- VRFY (user enumeration; server may return 252 even for non-existent users -> unreliable):

```bash
VRFY root
252 2.0.0 root

VRFY cry0l1t3
252 2.0.0 cry0l1t3

```

- Sending an email (example session):

```bash
EHLO inlanefreight.htb
MAIL FROM: <cry0l1t3@inlanefreight.htb>
250 2.1.0 Ok
RCPT TO: <mrb3n@inlanefreight.htb> NOTIFY=success,failure
250 2.1.5 Ok
DATA
354 End data with <CR><LF>.<CR><LF>
From: <cry0l1t3@inlanefreight.htb>
To: <mrb3n@inlanefreight.htb>
Subject: DB
Date: Tue, 28 Sept 2021 16:32:51 +0200
Hey man, I am trying to access our XY-DB but the creds don't work.
Did you make any changes there?
.
250 2.0.0 Ok: queued as 6E1CF1681AB
QUIT
221 2.0.0 Bye

```

#### Footprinting & Discovery

- Nmap `sC -sV -p25` can enumerate SMTP features (via EHLO) and service/version.
- Example nmap output shows supported ESMTP extensions: `PIPELINING, SIZE, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING`.

#### Open Relay Detection

- Use `smtp-open-relay` NSE script (Nmap) runs multiple tests to detect relaying.

```bash
J0n4ss@htb[/htb]$ sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v
```

- Example `smtp-open-relay` output: "Server is an open relay (16/16 tests)" with sample MAIL FROM/RCPT TO test cases.
- Proxy CONNECT method can be used to reach SMTP through an HTTP proxy:

```bash
CONNECT 10.129.14.128:25 HTTP/1.0

```

#### Mail Headers

- Headers contain sender/recipient, timestamps, routing hops, content-type, etc. Defined by [RFC5322](https://datatracker.ietf.org/doc/html/rfc5322).
- Useful for forensics and tracing but can be forged.

#### Dangerous / Misleading Server Settings

- `mynetworks = 0.0.0.0/0` ‚Üí open relay.
- VRFY may return `252` even for non-existent users; avoid relying solely on VRFY results.

#### Defense & Best Practices

- Restrict `mynetworks` to known IP ranges.
- Require authentication for submission (use MSA on port 587 with STARTTLS).
- Enforce TLS (STARTTLS for opportunistic; require when possible).
- Implement SPF, DKIM, DMARC to reduce spoofing and phishing.
- Disable or harden VRFY/EXPN responses.
- Monitor and block known spam patterns; quarantine suspicious messages.
- Regularly audit mail server configuration; run open-relay checks and Nmap NSE scripts.

#### Quick Checklist for Penetration Testing / Recon

- Telnet to port 25: test EHLO, VRFY, EXPN, and attempt mail transaction.
- Use Nmap `smtp-commands` and `smtp-open-relay` scripts.
- Check Postfix `/etc/postfix/main.cf` for dangerous values (mynetworks, smtpd_* options).
- Check for STARTTLS availability and whether AUTH is advertised only after TLS.
- Test proxy CONNECT to reach SMTP if direct access blocked.

#### POC Questions (SMTP)

1. Enumerate the SMTP service and submit the banner, including its version as the answer.

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ telnet 10.129.42.195 25
Trying 10.129.42.195...
Connected to 10.129.42.195.
Escape character is '^]'.
220 InFreight ESMTP v2.11
```

InFreight ESMTP v2.11

1. Enumerate the SMTP service even further and find the username that exists on the system. Submit it as the answer.

```bash
[msf](Jobs:0 Agents:0) auxiliary(scanner/smtp/smtp_enum) >> set USER_FILE ./smtp_users.txt
USER_FILE => ./smtp_users.txt
[msf](Jobs:0 Agents:0) auxiliary(scanner/smtp/smtp_enum) >> show options

Module options (auxiliary/scanner/smtp/smtp_enum):

   Name       Current Setting   Required  Description
   ----       ---------------   --------  -----------
   RHOSTS     10.129.42.195     yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploi
                                          t.html
   RPORT      25                yes       The target port (TCP)
   THREADS    1                 yes       The number of concurrent threads (max one per host)
   UNIXONLY   true              yes       Skip Microsoft bannered servers when testing unix users
   USER_FILE  ./smtp_users.txt  yes       The file that contains a list of probable users accounts.

View the full module info with the info, or info -d command.

[msf](Jobs:0 Agents:0) auxiliary(scanner/smtp/smtp_enum) >> run
[*] 10.129.42.195:25      - 10.129.42.195:25 Banner: 220 InFreight ESMTP v2.11
[+] 10.129.42.195:25      - 10.129.42.195:25 Users found: , robin
[*] 10.129.42.195:25      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

robin

---

## 3.6. IMAP/POP3

#### Overview

The **Internet Message Access Protocol (IMAP)** allows access to emails directly from a mail server.

Unlike **Post Office Protocol (POP3)**, IMAP enables **online management of emails** directly on the server and supports **folder structures**.

- IMAP is **client-server-based**, allowing synchronization of local email clients with the mailbox on the server.
- POP3 provides limited functionality ‚Äî listing, retrieving, and deleting emails only.
- IMAP supports:
    - Hierarchical mailboxes.
    - Access to multiple mailboxes in a session.
    - Preselection of emails.

Clients can create **local copies** of messages, and IMAP ensures **synchronization across multiple clients**.

Emails remain on the server until deleted.

IMAP is **text-based**, supports **multi-user access**, and requires an active server connection (though some clients offer offline modes).

---

#### IMAP Connection Details

- **Default Port:** `143`
- **Encrypted Port (SSL/TLS):** `993`
- **Authentication:** Username and password after connection establishment.
- **Commands:** Sent in ASCII; multiple commands can be sent before receiving server confirmations.

**SMTP** is typically used to send emails. Sent emails can be copied to IMAP folders for synchronization across clients.

###### Advantages of IMAP

- Folder creation and structure management.
- Centralized access to sent messages.
- Multi-client synchronization.

###### Disadvantages

- Higher **server storage requirements**.
- Requires encryption (SSL/TLS) for security, as IMAP is unencrypted by default.

---

#### Default Configuration

IMAP and POP3 have extensive configuration options.

To explore them:

```bash
sudo apt install dovecot-imapd dovecot-pop3d

```

Refer to the **Dovecot documentation** for configuration details and experiments.

---

#### IMAP Commands

| Command | Description |
| --- | --- |
| `1 LOGIN username password` | User's login. |
| `1 LIST "" *` | Lists all directories. |
| `1 CREATE "INBOX"` | Creates a mailbox. |
| `1 DELETE "INBOX"` | Deletes a mailbox. |
| `1 RENAME "ToRead" "Important"` | Renames a mailbox. |
| `1 LSUB "" *` | Lists subscribed mailboxes. |
| `1 SELECT INBOX` | Opens the INBOX for access. |
| `1 UNSELECT INBOX` | Exits the selected mailbox. |
| `1 FETCH <ID> all` | Retrieves data from a message. |
| `1 CLOSE` | Removes messages with the Deleted flag. |
| `1 LOGOUT` | Closes the IMAP connection. |

---

#### POP3 Commands

| Command | Description |
| --- | --- |
| `USER username` | Identifies the user. |
| `PASS password` | Authenticates with password. |
| `STAT` | Requests message count. |
| `LIST` | Lists emails with size info. |
| `RETR id` | Retrieves an email by ID. |
| `DELE id` | Deletes an email by ID. |
| `CAPA` | Displays server capabilities. |
| `RSET` | Resets message deletion marks. |
| `QUIT` | Closes connection. |

---

#### Dangerous Settings

Improperly configured mail servers can leak sensitive information.

| Setting | Description |
| --- | --- |
| `auth_debug` | Enables authentication debug logging. |
| `auth_debug_passwords` | Logs submitted passwords and schemes. |
| `auth_verbose` | Logs failed authentication attempts. |
| `auth_verbose_passwords` | Logs passwords used for authentication. |
| `auth_anonymous_username` | Defines username for anonymous SASL login. |

**Misconfiguration risks:**

- Unauthorized access.
- Credential exposure.
- Leakage of confidential emails.

---

#### Footprinting the Service

###### Default Ports

| Protocol | Port | Encrypted Port |
| --- | --- | --- |
| POP3 | 110 | 995 |
| IMAP | 143 | 993 |

The encrypted ports (993/995) use **SSL/TLS**.

###### Nmap Scan Example

```bash
sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC

```

**Sample Output:**

```
PORT    STATE SERVICE  VERSION
110/tcp open  pop3     Dovecot pop3d
143/tcp open  imap     Dovecot imapd
993/tcp open  ssl/imap Dovecot imapd
995/tcp open  ssl/pop3 Dovecot pop3d

```

The certificate indicates:

```
commonName=mail1.inlanefreight.htb
organizationName=Inlanefreight
stateOrProvinceName=California
countryName=US

```

These details reveal organization and service information.

---

#### Example: Accessing IMAP with cURL

```bash
curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd

```

**Output:**

```
* LIST (\HasNoChildren) "." Important
* LIST (\HasNoChildren) "." INBOX

```

Using verbose mode (`-v`) displays detailed TLS and connection information:

```bash
curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v

```

You can see:

- TLS version and cipher suite.
- SSL certificate details.
- IMAP server capabilities.

---

#### Example: OpenSSL Interaction

###### POP3 over SSL

```bash
openssl s_client -connect 10.129.14.128:pop3s

```

###### IMAP over SSL

```bash
openssl s_client -connect 10.129.14.128:imaps

```

Both commands reveal:

- Certificate details.
- TLS session information.
- Server greeting messages.

---

#### Practical Notes

- After login, IMAP/POP3 commands can navigate mailboxes.
- Experimenting with your **own mail server** (e.g., Dovecot) helps understand real-world configurations.
- Credentials like `robin:robin` (found via SMTP section) can be tested to authenticate to IMAP/POP3 services.

---

#### POC Questions (IMAP/POP3)

1. Figure out the exact organization name from the IMAP/POP3 service and submit it as the answer.

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ nmap -sV -p110,143,993,995 10.129.252.208 -sC
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-10-05 14:48 CDT
Nmap scan report for 10.129.252.208
Host is up (0.0085s latency).

PORT    STATE SERVICE  VERSION
110/tcp open  pop3     Dovecot pop3d
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Not valid before: 2021-11-08T23:10:05
|_Not valid after:  2295-08-23T23:10:05
|_pop3-capabilities: CAPA UIDL SASL STLS TOP AUTH-RESP-CODE PIPELINING RESP-CODES
143/tcp open  imap     Dovecot imapd
|_imap-capabilities: have listed ID more ENABLE post-login LOGINDISABLEDA0001 capabilities IDLE STARTTLS LOGIN-REFERRALS Pre-login IMAP4rev1 LITERAL+ SASL-IR OK
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Not valid before: 2021-11-08T23:10:05
|_Not valid after:  2295-08-23T23:10:05
993/tcp open  ssl/imap Dovecot imapd
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Not valid before: 2021-11-08T23:10:05
|_Not valid after:  2295-08-23T23:10:05
|_imap-capabilities: have listed ID ENABLE more post-login capabilities IDLE Pre-login AUTH=PLAINA0001 OK IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS
995/tcp open  ssl/pop3 Dovecot pop3d
|_ssl-date: TLS randomness does not represent time
|_pop3-capabilities: CAPA UIDL SASL(PLAIN) USER TOP AUTH-RESP-CODE PIPELINING RESP-CODES
| ssl-cert: Subject: commonName=dev.inlanefreight.htb/organizationName=InlaneFreight Ltd/stateOrProvinceName=London/countryName=UK
| Not valid before: 2021-11-08T23:10:05
|_Not valid after:  2295-08-23T23:10:05

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.35 seconds
```

InlaneFreight Ltd

1. What is the FQDN that the IMAP and POP3 servers are assigned to?

dev.inlanefreight.htb

1. Enumerate the IMAP service and submit the flag as the answer. (Format: HTB{...})

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ openssl s_client -connect 10.129.252.208:imaps
CONNECTED(00000003)
Can't use SSL_get_servername
depth=0 C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
verify error:num=18:self-signed certificate
verify return:1
depth=0 C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
verify return:1
---
Certificate chain
 0 s:C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
   i:C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Nov  8 23:10:05 2021 GMT; NotAfter: Aug 23 23:10:05 2295 GMT
...SNIP...
---
read R BLOCK
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] HTB{roncfbw7iszerd7shni7jr2343zhrj}
```

HTB{roncfbw7iszerd7shni7jr2343zhrj}

1. What is the customized version of the POP3 server?

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ openssl s_client -connect 10.129.252.208:pop3s
CONNECTED(00000003)
Can't use SSL_get_servername
depth=0 C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
verify error:num=18:self-signed certificate
verify return:1
depth=0 C = UK, ST = London, L = London, O = InlaneFreight Ltd, OU = DevOps Dep\C3\83artment, CN = dev.inlanefreight.htb, emailAddress = cto.dev@dev.inlanefreight.htb
verify return:1
...SNIP...
---
read R BLOCK
+OK InFreight POP3 v9.188
```

InFreight POP3 v9.188

1. What is the admin email address?

```bash

‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ openssl s_client -connect 10.129.252.208:imaps
...SNIP...
---
read R BLOCK
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN] HTB{roncfbw7iszerd7shni7jr2343zhrj}
a1 list "" *
a1 BAD Error in IMAP command received by server.
a2 login robin robin
a2 OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY PREVIEW=FUZZY LITERAL+ NOTIFY SPECIAL-USE] Logged in
a3 list "" *
* LIST (\Noselect \HasChildren) "." DEV
* LIST (\Noselect \HasChildren) "." DEV.DEPARTMENT
* LIST (\HasNoChildren) "." DEV.DEPARTMENT.INT
* LIST (\HasNoChildren) "." INBOX
a3 OK List completed (0.001 + 0.000 secs).
a4 select DEV.DEPARTMENT.INT
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)] Flags permitted.
* 1 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 1636414279] UIDs valid
* OK [UIDNEXT 2] Predicted next UID
a4 OK [READ-WRITE] Select completed (0.001 + 0.000 secs).
a5 search unseen
* SEARCH
a5 OK Search completed (0.001 + 0.000 secs).
a6 search seen
* SEARCH 1
a6 OK Search completed (0.001 + 0.000 secs).
a7 fetch 1 all
* 1 FETCH (FLAGS (\Seen) INTERNALDATE "08-Nov-2021 23:51:24 +0000" RFC822.SIZE 167 ENVELOPE ("Wed, 03 Nov 2021 16:13:27 +0200" "Flag" (("CTO" NIL "devadmin" "inlanefreight.htb")) (("CTO" NIL "devadmin" "inlanefreight.htb")) (("CTO" NIL "devadmin" "inlanefreight.htb")) (("Robin" NIL "robin" "inlanefreight.htb")) NIL NIL NIL NIL))
a7 OK Fetch completed (0.001 + 0.000 secs).
a8 fetch 1 RFC822
* 1 FETCH (RFC822 {167}
Subject: Flag
To: Robin <robin@inlanefreight.htb>
From: CTO <devadmin@inlanefreight.htb>
Date: Wed, 03 Nov 2021 16:13:27 +0200

HTB{983uzn8jmfgpd8jmof8c34n7zio}
)
a8 OK Fetch completed (0.001 + 0.000 secs).

```

devadmin@inlanefreight.htb

1. Try to access the emails on the IMAP server and submit the flag as the answer. (Format: HTB{...})

HTB{983uzn8jmfgpd8jmof8c34n7zio}

---

## 3.7. SNMP

`Simple Network Management Protocol` ([SNMP](https://datatracker.ietf.org/doc/html/rfc1157)) was created to monitor network devices. It can also handle configuration tasks and change settings remotely.

SNMP-enabled hardware includes routers, switches, servers, IoT devices, and other devices that can be queried and controlled using this standard protocol.

Thus, it is a protocol for **monitoring and managing network devices**. The current version is **SNMPv3**, which improves security but also increases complexity.

SNMP transmits both information and control commands using agents over **UDP port 161**. The client can set values or change settings with these commands.

SNMP also supports **traps** ‚Äî unsolicited data packets sent from the SNMP server to the client on **UDP port 162** when specific events occur.

For SNMP communication, each SNMP object must have a **unique address (OID)** known to both sides. This addressing mechanism is crucial for successful data transmission and network monitoring.

---

#### **MIB**

To ensure interoperability across manufacturers, the **Management Information Base (MIB)** was created.

- MIBs are **text files** listing all queryable SNMP objects in a standardized **tree hierarchy**.
- Each entry includes an **Object Identifier (OID)**, unique address, name, type, access rights, and description.
- MIBs are written in **ASN.1 (Abstract Syntax Notation One)** format.
- MIBs do **not contain data** ‚Äî they define *where and how* data can be found.

---

#### **OID**

An **Object Identifier (OID)** represents a node in a hierarchical namespace.

- Each node is identified by a **sequence of integers**, forming a path in the tree.
- OIDs use **dot notation** (e.g., `1.3.6.1.2.1.1.1.0`).
- The longer the chain, the more specific the information.

You can look up MIBs and OIDs in the [Object Identifier Registry](https://www.alvestrand.no/objectid/).

---

#### **SNMP Versions**

###### **SNMPv1**

- First version, still used in small networks.
- Supports basic device monitoring, configuration, and traps.
- **No authentication or encryption** ‚Äî all data is sent in plaintext.

###### **SNMPv2**

- The most used variant today is **SNMPv2c** (‚Äúcommunity-based SNMP‚Äù).
- Functionally extended, but still **insecure** ‚Äî community strings are sent **in plaintext**.
- No built-in encryption or authentication.

###### **SNMPv3**

- Introduced **authentication (username/password)** and **encryption** (via pre-shared keys).
- Far more secure, but **complex to configure**.

---

#### **Community Strings**

Community strings act as **passwords** controlling access to SNMP data.

- Often still used with **SNMPv2c**, despite security risks.
- Transmitted **unencrypted**, making them susceptible to interception.
- Common default strings: `public` (read-only), `private` (read-write).

---

#### **Default Configuration**

The default SNMP daemon configuration defines core service settings ‚Äî IP addresses, ports, MIBs, OIDs, authentication, and community strings.

###### **SNMP Daemon Config**

```bash
J0n4ss@htb[/htb]$ cat /etc/snmp/snmpd.conf | grep -v "##" | sed -r '/^\s*$/d'

sysLocation    Sitting on the Dock of the Bay
sysContact     Me <me@example.org>
sysServices    72
master  agentx
agentaddress  127.0.0.1,[::1]
view   systemonly  included   .1.3.6.1.2.1.1
view   systemonly  included   .1.3.6.1.2.1.25.1
rocommunity  public default -V systemonly
rocommunity6 public default -V systemonly
rouser authPrivUser authpriv -V systemonly

```

üìò Reference: [snmpd.conf manpage](https://www.net-snmp.org/docs/man/snmpd.conf.html)

---

#### **Dangerous Settings**

| **Setting** | **Description** |
| --- | --- |
| `rwuser noauth` | Grants full access to the OID tree without authentication. |
| `rwcommunity <community string> <IPv4 address>` | Grants full access regardless of request source. |
| `rwcommunity6 <community string> <IPv6 address>` | Same as above, but for IPv6. |

---

#### **Footprinting the Service**

To footprint SNMP services, common tools include:

- `snmpwalk` ‚Äì Enumerates OIDs and their data.
- `onesixtyone` ‚Äì Brute-forces community strings.
- `braa` ‚Äì Brute-forces OIDs for enumeration.

---

#### **SNMPwalk Example**

```bash
J0n4ss@htb[/htb]$ snmpwalk -v2c -c public 10.129.14.128
iso.3.6.1.2.1.1.1.0 = STRING: "Linux htb 5.11.0-34-generic ..."
iso.3.6.1.2.1.1.4.0 = STRING: "mrb3n@inlanefreight.htb"
iso.3.6.1.2.1.1.6.0 = STRING: "Sitting on the Dock of the Bay"
iso.3.6.1.2.1.25.6.3.1.2.1243 = STRING: "python3_3.8.2-0ubuntu2_amd64"
...

```

When **misconfigured**, SNMPv1/v2c can leak extensive internal system info ‚Äî such as installed packages, usernames, and hostnames.

---

#### **OneSixtyOne Example**

```bash
J0n4ss@htb[/htb]$ sudo apt install onesixtyone
J0n4ss@htb[/htb]$ onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.14.128

Scanning 1 hosts, 3220 communities
10.129.14.128 [public] Linux htb 5.11.0-37-generic ...

```

üß† **Tip:**

Administrators often use predictable naming patterns for community strings (e.g., hostnames).

You can generate wordlists using **Crunch** or similar tools.

---

#### **Braa Example**

```bash
J0n4ss@htb[/htb]$ sudo apt install braa
J0n4ss@htb[/htb]$ braa <community string>@<IP>:.1.3.6.*
## Example
J0n4ss@htb[/htb]$ braa public@10.129.14.128:.1.3.6.*
10.129.14.128:20ms:.1.3.6.1.2.1.1.4.0:mrb3n@inlanefreight.htb
10.129.14.128:20ms:.1.3.6.1.2.1.1.5.0:htb
10.129.14.128:20ms:.1.3.6.1.2.1.1.6.0:US
...

```

---

#### **Practice Recommendation**

Set up a local VM running SNMP to experiment with configurations.

This hands-on approach will deepen your understanding of:

- Security implications of SNMP versions.
- Effects of misconfigured access controls.
- Enumeration techniques.

SNMP can be a **boon for system administrators** but a **risk for security analysts** if not properly secured.

---

Would you like me to **save this Markdown as `snmp_notes.txt`** for you to download?

#### POC Questions (SNMP)

1. Enumerate the SNMP service and obtain the email address of the admin. Submit it as the answer.

`Onesixtyone`¬†can be used to brute-force the names of the community strings since they can be named arbitrarily by the administrator.¬†We do not know these, so we use¬†`onesixtyone`¬†and¬†`SecLists`¬†wordlists to identify these community strings.

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.67.134
Scanning 1 hosts, 3219 communities
10.129.67.134 [public] Linux NIX02 5.4.0-90-generic ##101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64
10.129.67.134 [public] Linux NIX02 5.4.0-90-generic ##101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64
```

`Snmpwalk`¬†is used to query the OIDs with their information :

```bash
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ snmpwalk -v2c -c public 10.129.67.134 > snmp-oids.txt
‚îî‚îÄ‚îÄ‚ïº [‚òÖ]$ less snmp-oids.txt 
iso.3.6.1.2.1.1.1.0 = STRING: "Linux NIX02 5.4.0-90-generic ##101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64"
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 = Timeticks: (131040) 0:21:50.40
iso.3.6.1.2.1.1.4.0 = STRING: "devadmin <devadmin@inlanefreight.htb>"
iso.3.6.1.2.1.1.5.0 = STRING: "NIX02"
iso.3.6.1.2.1.1.6.0 = STRING: "InFreight SNMP v0.91"
...SNIP...
```

**Solution 2:** Once we know a community string, we can also use it with¬†[braa](https://github.com/mteg/braa)¬†to brute-force the individual OIDs and enumerate the information behind them.

From the https://www.alvestrand.no/objectid/ ‚Üí The Internet OID is¬†[1.3.6.1](https://www.alvestrand.no/objectid/1.3.6.1.html); this link leads directly to it.

devadmin@inlanefreight.htb

1. What is the customized version of the SNMP server?

InFreight SNMP v0.91

1. Enumerate the custom script that is running on the system and submit its output as the answer.

To answer this question I kept looking for clues in the file snmp-oids.txt that has outputs from `snmpwalk` tool.