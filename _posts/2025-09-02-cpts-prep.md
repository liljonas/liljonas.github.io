---
title: Footprinting
date: 2025-09-02 16:30:00
categories: [CPTS Preparation, Information Gathering]
tags: [Enumeration, Footprinting]     ## TAG names should always be lowercase
---

## **1. Introduction**

## 1.1. Enumeration Principles ‚Äî Structured Learning Summary

#### Reconnaissance vs Enumeration

- **OSINT (Open-Source Intelligence)**
    - Passive only ‚Äî collects information from public/third-party sources (WHOIS, search engines, social media, breach data).
    - Independent from enumeration ‚Äî does not involve direct interaction with the target.
- **Enumeration**
    - Active and semi-active techniques: scanning, banner grabbing, service probing.
    - Iterative loop: each new piece of information informs further enumeration.
    - Targets: domains, IP ranges, services (SSH, RDP, WinRM, HTTP, SMTP, etc.), infrastructure layouts.

**Reasoning Layer:** OSINT provides context without touching the target, while enumeration involves **direct interaction** and is the foundation for exploitation planning. Mixing the two often leads to confusion about legality, scope, and technique.

---

#### Understanding Enumeration

###### Why Enumeration Matters

- Builds a **map of the infrastructure**: services, protocols, communication layers.
- Prevents noisy, blind attacks (e.g., brute-forcing credentials without knowing defenses).
- Focuses on **understanding before attacking** ‚Äî reducing the chance of triggering detection/lockouts.

**Analogy:**
A treasure hunter does not randomly dig; they study maps, prepare tools, and plan the expedition. Similarly, enumeration prepares the penetration tester by mapping what exists and what may be hidden.

---

#### Enumeration Pitfalls

- **Wrong approach:**
    - Immediately brute-forcing services like SSH or RDP.
    - Generates noise, risks detection/blacklisting.
    - Misses deeper insights into **how the infrastructure works**.
- **Right approach:**
    - Study how the company is structured (internal vs external services, vendors, security measures).
    - Look at what‚Äôs **visible** and **not visible** (hidden services, indirect evidence).
    - Form hypotheses, validate with scans, and refine.

**Reasoning Layer:** Enumeration is not about rushing into exploitation but **laying the groundwork** for controlled, informed attacks.

---

#### Enumeration Principles & Guiding Questions

###### Core Principles

| No. | Principle | Description |
| --- | --- | --- |
| 1 | **There is more than meets the eye** | Always consider multiple viewpoints and hidden layers. |
| 2 | **Distinguish between what we see and what we do not see** | Visible data vs invisible but inferable data. |
| 3 | **There are always ways to gain more information** | Continue digging logically; enumeration never ends at the first discovery. |

---

###### Guiding Questions

When enumerating a target, continuously ask:

1. **What can we see?**
2. **Why are we seeing it?** (legit exposure vs misconfig)
3. **What image does this create?** (what picture of the target is emerging?)
4. **What do we gain from it?** (is it useful for exploitation paths?)
5. **How can we use it?** (leverage for pivoting/escalation)
6. **What can we not see?** (hidden systems, filtered ports, masked services)
7. **Why can‚Äôt we see it?** (firewalls, segmentation, obscurity)
8. **What image results from what we do not see?** (inference from absence ‚Äî e.g., missing ports, blocked responses).

**Reasoning Layer:** The questions force testers to look **beyond the obvious** and integrate inference, not just raw scan results.

---

#### Lessons Learned

- Enumeration is a **strategic phase**, not a brute-force phase.
- Focus on **understanding the infrastructure** rather than blindly attacking.
- Always distinguish between **seen and unseen components**.
- Maintain a mindset that **information is iterative** ‚Äî each discovery leads to further hypotheses.
- Penetration testing is not about exploiting first, but about knowing **how systems can be exploited**.

---

#### Summary Table

| Topic | Tools/Techniques | Example | Lessons Learned |
| --- | --- | --- | --- |
| OSINT vs Enumeration | Passive vs Active methods | WHOIS (OSINT), `nmap -sV` (Enumeration) | Keep OSINT separate; OSINT informs enumeration but doesn‚Äôt replace it |
| Understanding Services | Scanning, banner grabbing, protocol analysis | `nmap -p 22,3389 -sV target` | Understand purpose of services before attacking |
| Pitfalls | Brute force, noisy scans | Hydra brute-forcing SSH | Leads to detection/blacklisting, loses stealth |
| Enumeration Principles | Applying guiding questions | ‚ÄúWhat do we not see?‚Äù ‚Üí Filtered ports | Enumeration = iterative discovery, not one-time scan |
| Best Practices | Structured approach, inference, continuous loop | Service mapping, correlating logs & responses | Proper enumeration reveals hidden layers attackers can exploit later |

---

üìå **Tip for Practice:** Write down the principles and guiding questions where you can easily refer to them during labs and real engagements. This ensures you stay in **strategic mode** rather than rushing into noisy attacks.

---

## **1.2.** Enumeration Methodology

#### üìå Overview

- Complex processes like **enumeration** require a standardized methodology.
- Many testers rely on habits/experience, but without structure, this risks gaps and inefficiency.
- Penetration testing is **dynamic**, so we need a **static framework** that allows flexibility.

Enumeration methodology is structured into **3 levels** and **6 layers**.

---

#### üîë Enumeration Levels

1. **Infrastructure-based Enumeration**
2. **Host-based Enumeration**
3. **OS-based Enumeration**

---

![enum-method33.webp](/assets/img/cpts/enum-method33.webp)
_Enumeration levels_

> Note: The components of each layer shown represent the main categories and not a full list of all the components to search for. Additionally, it must be mentioned here that the first and second layer (Internet Presence, Gateway) does not quite apply to the intranet, such as an Active Directory infrastructure. The layers for internal infrastructure will be covered in other modules.
{: .prompt-info }


#### üèõÔ∏è Enumeration Layers

| Layer | Description | Information Categories | Goal |
| --- | --- | --- | --- |
| **1. Internet Presence** | Identify internet-facing presence & external infrastructure | Domains, Subdomains, vHosts, ASN, Netblocks, IPs, Cloud Instances, Security Measures | Find all possible target systems & interfaces |
| **2. Gateway** | Identify protections securing external/internal infra | Firewalls, DMZ, IPS/IDS, EDR, Proxies, NAC, Segmentation, VPN, Cloudflare | Understand defenses & what to watch out for |
| **3. Accessible Services** | Identify externally/internally accessible services | Service type, Functionality, Configuration, Ports, Versions, Interfaces | Understand reason & function of services, how to interact/exploit them |
| **4. Processes** | Internal processes tied to services | PIDs, Processed Data, Tasks, Source, Destination | Understand dependencies & data flow |
| **5. Privileges** | Permissions and privileges tied to services | Groups, Users, Permissions, Restrictions, Environment | Identify overlooked/abusable privileges |
| **6. OS Setup** | Internal OS setup & security posture | OS Type, Patch Level, Config, Environment, Sensitive Files | Assess security management & glean sensitive info |

---

#### üß© Visual Representation (ASCII Flow)

```
  +---------------------+
  |   Internet Presence |
  +---------------------+
             ‚Üì
  +---------------------+
  |       Gateway       |
  +---------------------+
             ‚Üì
  +---------------------+
  | Accessible Services |
  +---------------------+
             ‚Üì
  +---------------------+
  |      Processes      |
  +---------------------+
             ‚Üì
  +---------------------+
  |     Privileges      |
  +---------------------+
             ‚Üì
  +---------------------+
  |      OS Setup       |
  +---------------------+

```

Each **layer = wall** in a labyrinth.

We look for **gaps/vulnerabilities** instead of smashing blindly.

---

#### üß≠ Practical Notes

- **Not all gaps lead inside** ‚Üí time-limited tests mean prioritization is critical.
- **SolarWinds example**: Attackers studied infrastructure for months ‚Üí highlights the need for systematic methodology.
- A methodology **is not** a toolset or cheat sheet.
- Tools differ, but methodology remains the **structured process**.

---

#### ‚úÖ Key Takeaways

- Enumeration methodology is about **systematic discovery**, not exploitation.
- Always consider **all 6 layers**; don‚Äôt get stuck brute-forcing the obvious.
- Flexibility is essential, but structure prevents mistakes.
- Remember: **there is almost always a way in** ‚Äî time and methodology determine whether we find it.

---

## **2. Infrastructure Based Enumeration**

## 2.1. Domain Information

#### Reconnaissance

During the **domain information phase**, the goal is to build a picture of a company‚Äôs online footprint without active interaction. This is crucial in black-box engagements, where only target scope is provided.

- **Principles:**
    - Observe what is **presented** (visible services, domains).
    - Consider what is **not presented** but implied (backend technologies, service dependencies).
    - Take a developer‚Äôs perspective: *what infrastructure is required to run these services?*
- **Approach:**
    - Review the main website to understand company services (e.g., IoT, hosting, IT security).
    - Identify relevant technologies and hosting structures.
    - Use passive information sources to remain hidden (customer-like activity).

---

#### Enumeration

###### SSL Certificate Analysis

- SSL certificates often include multiple **Subject Alternative Names (SANs)**, revealing subdomains.
- Example:
    
    ```
    Valid: May 18, 2021 ‚Äì Apr 6, 2022
    DNS: inlanefreight.htb, www.inlanefreight.htb, support.inlanefreight.htb
    
    ```
    
- Certificate Transparency (CT) logs at [crt.sh](https://crt.sh/) allow subdomain discovery.

###### Certificate Transparency Queries

- Query via browser or command line:
    
    ```bash
    curl -s "<https://crt.sh/?q=inlanefreight.com&output=json>" | jq .
    
    ```
    
- Extract unique subdomains:
    
    ```bash
    curl -s "<https://crt.sh/?q=inlanefreight.com&output=json>" | jq .     | grep name | cut -d":" -f2 | grep -v "CN=" | cut -d'"' -f2     | sort -u
    
    ```
    
- Findings included:
    - `matomo.inlanefreight.com`
    - `smartfactory.inlanefreight.com`
    - `iot.inlanefreight.com`
    - `marina-live.inlanefreight.com`
    - `account.ttn.inlanefreight.com`
    - Many others.

---

###### Host Resolution

- Resolve which subdomains map to internal IPs owned by the company:
    
    ```bash
    for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4;done
    ```
    
- Examples:
    
    ```
    blog.inlanefreight.com      10.129.24.93
    inlanefreight.com           10.129.27.33
    matomo.inlanefreight.com    10.129.127.22
    www.inlanefreight.com       10.129.127.33
    
    ```
    
- Note: Third-party hosted servers (e.g., AWS S3) are out of scope unless permitted.
- Once we see which hosts can be investigated further, we can generate a list of IP addresses with a minor adjustment to the¬†`cut`¬†command and run them through¬†`Shodan`.

---

###### Shodan Lookups

- Automate enumeration against IPs:
    
    ```bash
    for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f4 >> ip-addresses.txt;done
    
    for i in $(cat ip-addresses.txt); do shodan host $i;done
    ```
    
- Example results:
    - **10.129.24.93** ‚Äì Nginx, ports 80/443
    - **10.129.27.33** ‚Äì OpenSSH 7.6p1, Nginx, TLS details
    - **10.129.127.22** ‚Äì Apache HTTPD, multiple services (25, 53, 80, 81, 110, 111, 443, 444)

---

###### DNS Records

- Query full records:
    
    ```bash
    dig any inlanefreight.com
    ```
    
- Key findings:
    - **A Records:** Map subdomains to known IPs.
    - **MX Records:** Email managed by Google (`aspmx.l.google.com`).
    - **NS Records:** Managed by INWX (`ns.inwx.net`, `ns2.inwx.net`).
    - **TXT Records:**
        - `atlassian-domain-verification`
        - `google-site-verification`
        - `logmein-verification-code`
        - `spf1` includes Mailgun, Google, Outlook, Atlassian and additional IPs (`ip4:10.129.24.8`	`ip4:10.129.27.2`	`ip4:10.72.82.106`)

---

#### Insights & Context

- **Atlassian** ‚Üí Internal collaboration/development platform (potential Jira/Confluence exposure).
- **Google Workspace (Gmail)** ‚Üí Email handling; possible GDrive integrations.
- **LogMeIn** ‚Üí Centralized remote access ‚Äì critical if compromised.
- **Mailgun** ‚Üí APIs for email management, potential API exploitation surface.
- **Outlook (O365)** ‚Üí Suggests use of OneDrive/Azure storage (SMB access possible).
- **INWX** ‚Üí Domain registrar/hosting provider. TXT record includes identifiers useful for OSINT.

---

#### Lessons Learned

- Passive recon (certificates, DNS, third-party services) can reveal **internal services, tech stack, and potential attack surfaces** without touching the target directly.
- TXT records often expose **third-party integrations**‚Äîvaluable for identifying dependencies and shadow IT.
- Shodan enrichment provides visibility into **open services and software versions** before active probing.

**Reasoning Layer:**

These lessons reinforce why passive techniques are so valuable: they expand visibility while keeping the tester undetected. Each insight helps plan focused, compliant active testing.

---

#### Summary Table

| Topic | Tools/Techniques Used | Key Commands/Methods | Notable Findings | Lessons Learned |
| --- | --- | --- | --- | --- |
| SSL Certificates | Browser, [crt.sh](https://crt.sh/), curl | `curl ‚Ä¶ [crt.sh](https://crt.sh/) ‚Ä¶` | Certificate Transparency | Subdomains from SAN/CT logs |
| Subdomain Enumeration | [crt.sh](https://crt.sh/), bash parsing | `jq`, `grep`, `sort -u` | unique subdomains | CT logs are rich passive OSINT |
| Host Resolution | host, bash loop | `host $i` | `grep "has address"` | Internal IP mapping |
| Service Enumeration | Shodan | `shodan host <IP>` | OpenSSH, Apache, Nginx, mail services | Early service visibility w/o scanning |
| DNS Records | dig | `dig any domain.com` | MX (Google), TXT (Atlassian, LogMeIn, Mailgun) | TXT records reveal integrations |
| Third-Party Services | Passive OSINT | Review TXT/NS entries | Atlassian, O365, Mailgun, INWX | Dependencies = potential attack vectors |

## 2.2. Cloud Resources & **Company-Hosted Servers**

#### Reconnaissance

Cloud services such as **AWS, GCP, and Azure** are now a core part of many companies‚Äô infrastructure. While these providers secure the underlying infrastructure, misconfigurations by administrators can expose company data and services.

- **Key Risks:**
    - Publicly accessible storage (AWS S3, Azure Blob, GCP Cloud Storage).
    - Sensitive files (documents, code, keys) accessible without authentication.
    - Source code references to cloud-hosted content (e.g., JavaScript, CSS, images).

**Reasoning Layer:**

Cloud adoption increases flexibility and scalability but also enlarges the attack surface. Passive reconnaissance helps identify exposed cloud resources without interacting directly with the company‚Äôs infrastructure.

---

#### Enumeration

###### Subdomain & IP Resolution

Company subdomains resolving to internal and cloud resources:

```bash
for i in $(cat subdomainlist); do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4; done

```

Results:

```
blog.inlanefreight.com        10.129.24.93
inlanefreight.com             10.129.27.33
matomo.inlanefreight.com      10.129.127.22
www.inlanefreight.com         10.129.127.33
s3-website-us-west-2.amazonaws.com 10.129.95.250

```

**Reasoning Layer:**

Resolving subdomains identifies which services are hosted internally versus in the cloud. Spotting entries like `s3-website-us-west-2.amazonaws.com` immediately highlights possible exposed storage.

---

###### Google Dorking for Cloud Assets

- **AWS Search:**
    
    ```
    intext:<company> inurl:amazonaws.com
    ```
    
- **Azure Search:**
    
    ```
    intext:<company> inurl:blob.core.windows.net
    ```
    

Findings included **PDFs, text documents, presentations, and code samples**.

**Reasoning Layer:**

Google Dorks exploit indexed cloud storage, revealing files employees may have unintentionally left public. This provides passive visibility into sensitive company material.

---

###### Source Code Inspection

- Target websites often link to external resources:
    - DNS prefetch and preconnect to `.blob.core.windows.net`.
    - JavaScript, CSS, and images loaded from cloud storage.

**Reasoning Layer:**

Inspecting website source code helps identify storage endpoints and CDN integrations, which may be overlooked in DNS or Google search enumeration.

---

###### Third-Party Recon Tools

- **Domain.Glass**
    - Displays infrastructure details, SSL certificates, DNS names, and security assessments (e.g., Cloudflare ‚ÄúSafe‚Äù rating).
- **GrayHatWarfare**
    - Indexes publicly exposed cloud storage across AWS, Azure, and GCP.
    - Provides filtering by file type, bucket names, and search by company identifiers.

Example findings:

- AWS buckets with file counts: `1`, `73`, `0`.
- Publicly listed files: `id_rsa`, `id_rsa.pub` (SSH private/public keys).

**Reasoning Layer:**

Third-party tools enhance passive enumeration by aggregating data across providers. GrayHatWarfare in particular can uncover exposed buckets that traditional OSINT may miss. Discovering SSH keys demonstrates how misconfigurations can escalate into critical security breaches.

---

#### Exploitation Potential

- Public SSH private keys (`id_rsa`) allow attackers to authenticate without passwords.
- Public file listings (presentations, configs, scripts) may contain:
    - Hardcoded credentials.
    - Internal documentation.
    - API keys or secrets.

**Reasoning Layer:**

While not actively exploited during reconnaissance, these findings outline direct exploitation opportunities. Exposed SSH keys represent a **full compromise vector** if linked to valid systems.

---

#### Lessons Learned

- Cloud resource misconfigurations (e.g., public S3 buckets) are a **common attack vector**.
- Google Dorks and tools like GrayHatWarfare provide **low-effort, high-value OSINT**.
- Source code inspection can reveal hidden integrations with cloud storage.
- Leaked credentials or SSH keys drastically lower the barrier to full compromise.
- Companies should implement **strict IAM policies, bucket access controls, and key management**.

**Reasoning Layer:**

Cloud security is as much about configuration and governance as it is about the provider‚Äôs infrastructure. These findings reinforce why penetration testers must always check for misconfigured storage as part of standard recon.

---

#### Summary Table

| Topic | Tools/Techniques Used | Key Commands/Methods | Notable Findings | Lessons Learned |
| --- | --- | --- | --- | --- |
| Subdomain Resolution | host, bash loop | `host $i` with filter | S3 subdomain in DNS | Cloud storage often tied to DNS |
| Google Dorking | Google search | `intext:company inurl:amazonaws.com` | Indexed PDFs, docs | Search engines reveal exposed storage |
| Source Code Review | Browser DevTools | Inspect `<link>` and `<script>` | Azure Blob references | Web source reveals cloud dependencies |
| Domain.Glass | OSINT tool | Domain status page | Cloudflare protection status | Confirms use of security layers |
| GrayHatWarfare | Bucket search engine | Search company/bucket names | Public buckets, SSH keys | Misconfigurations expose critical assets |
| Exploitation Risk | Manual analysis | Review leaked files | `id_rsa` private key | Public keys can enable direct compromise |

---

## 2.3. Staff OSINT

#### Social Media & Employee Recon

- Employees on platforms like LinkedIn/Xing reveal infrastructure & technology stack.
- Job postings show required skills ‚Üí hints at used tools/tech.
- Employee posts and shared content show current focus areas.

---

#### LinkedIn - Job Post (Example)

```markdown
**Required Skills/Knowledge/Experience:**

- 3‚Äì10+ yrs software dev exp
- TS/SCI Security Clearance eligibility
- Degree in CS/CE/Math/related
- Object-Oriented Languages: Java, C##, C++
- Scripting Languages: Python, Ruby, PHP, Perl
- Databases: PostgreSQL, MySQL, SQL Server, Oracle
- ORM Frameworks: SQLAlchemy, Hibernate, Entity Framework
- Web Frameworks: Flask, Django, Spring, [ASP.NET](https://dotnet.microsoft.com/en-us/apps/aspnet) MVC
- Unit Testing: pytest, JUnit, NUnit, xUnit
- SOA/Microservices & RESTful API design
- Agile & Continuous Integration
- Version Control: Git, SVN, Mercurial, Perforce

**Desired Skills:**

- Security+ certification
- Atlassian suite (Confluence, Jira, Bitbucket)
- Algorithm Dev (e.g., Image Processing)
- Software Security
- Docker, Kubernetes
- Redis, NumPy

**Inference:**

- Tech stack: Java, C##, C++, Python, Ruby, PHP, Perl
- DBs: PostgreSQL, MySQL, Oracle
- Frameworks: Flask, Django, [ASP.NET](https://dotnet.microsoft.com/en-us/apps/aspnet), Spring
- Tools: Git, SVN, Perforce, Atlassian suite
- Focus on microservices, APIs, Agile, CI/CD
```

---

#### LinkedIn - Employee ##1 About

- Mentions: W3C specs, Web Components, React, Svelte, AngularJS
- GitHub link to OSS projects

**Risk Example:**

- OWASP Top10 for Django repo ‚Üí hints at common misconfigs
- Some files show personal email + hardcoded JWT

**PoC Snippets (from description):**

```json
{
  "name": "Example Name",
  "author": "Example Author",
  "email": "example@email.com",
  "github": "<https://github.com/example/repo>"
}

```

```python
def decode_jwt(payload, secret, jwt_token):
    ## JWT token redacted
    ## Example function logic
    pass

```

---

#### LinkedIn - Employee ##2 Career

- Roles: VP Software Engineer, Associate Software Engineer
- Work: CRM mobile app, BrokerVotes system
- Skills: Java, React, Slang, Elastic, Kafka

---

#### OSINT Strategy Notes

- LinkedIn advanced search allows filtering by role, tech, security staff.
- Security staff reveal org‚Äôs defensive posture.
- Employee profiles + job posts = map of infra, tools, security measures.

---

## 3. Host Based Enumeration

## 3.1 FTP

A structured knowledge summary covering FTP and TFTP reconnaissance, enumeration, exploitation, and analysis. Includes annotated commands, outputs, and reasoning layers.

---

#### Reconnaissance & Service Discovery

###### Identify FTP/TFTP Services

```bash
nmap -p21,69 -sV -sC -A 10.129.14.136
```

- **FTP (21/tcp)** ‚Üí often misconfigured with anonymous access.
- **TFTP (69/udp)** ‚Üí trivial file transfer, no authentication.

**Reasoning Layer:**
Initial reconnaissance identifies exposed services and versions. FTP/TFTP are known for weak authentication and misconfigurations, making them prime attack vectors.

---

#### Anonymous FTP Login & Manual Enumeration

###### Connect to FTP

```bash
ftp 10.129.14.136
Name: anonymous
Password: anonymous
```

###### Common FTP Commands

| Command | Description |
| --- | --- |
| `ls` | List directory contents |
| `cd` | Change directory |
| `get` | Download file |
| `put` | Upload file |
| `mget *` | Download multiple files |

**Reasoning Layer:**
Testing for anonymous login is a standard step; many FTP servers still allow it for ‚Äúpublic‚Äù file access, often exposing sensitive data.

---

#### Recursive Download with `wget`

###### Mirror Entire FTP Share

```bash
wget -m --no-passive <ftp://anonymous:anonymous@10.129.14.136>
```

Output shows recursive download of all files.
The tool creates a directory named after the target IP:

```bash
tree .
.
‚îî‚îÄ‚îÄ 10.129.14.136
    ‚îú‚îÄ‚îÄ Calendar.pptx
    ‚îú‚îÄ‚îÄ Clients
    ‚îÇ   ‚îî‚îÄ‚îÄ Inlanefreight
    ‚îÇ       ‚îú‚îÄ‚îÄ appointments.xlsx
    ‚îÇ       ‚îú‚îÄ‚îÄ contract.docx
    ‚îÇ       ‚îú‚îÄ‚îÄ meetings.txt
    ‚îÇ       ‚îî‚îÄ‚îÄ proposal.pptx
    ‚îú‚îÄ‚îÄ Documents
    ‚îÇ   ‚îú‚îÄ‚îÄ appointments-template.xlsx
    ‚îÇ   ‚îú‚îÄ‚îÄ contract-template.docx
    ‚îÇ   ‚îî‚îÄ‚îÄ contract-template.pdf
    ‚îú‚îÄ‚îÄ Employees
    ‚îî‚îÄ‚îÄ Important Notes.txt

```

**Reasoning Layer:**`wget -m` is efficient for downloading entire directory structures instead of manual single-file grabs, ensuring no data is missed during enumeration.

---

#### Upload File to FTP Server

###### Create Test File & Upload

```bash
touch testupload.txt
ftp> put testupload.txt
```

Result:

```
226 Transfer complete.
```

Confirm with `ls`:

```
-rw-------    1 1002     133    0 Sep 15 14:57 testupload.txt
```

**Reasoning Layer:**
Testing upload is crucial. If uploads are allowed in a web-accessible directory, this could lead to webshells or direct server compromise.

---

#### Automated Enumeration with Nmap & NSE

###### Update NSE Script Database

```bash
sudo nmap --script-updatedb
```

###### Locate FTP Scripts

```bash
find / -type f -name ftp* 2>/dev/null | grep scripts
```

Common scripts:

- `ftp-anon.nse`
- `ftp-syst.nse`
- `ftp-brute.nse`
- `ftp-vsftpd-backdoor.nse`

###### Run Scan with Scripts

```bash
sudo nmap -sV -p21 -sC -A 10.129.14.136
```

Sample Output:

```
21/tcp open  ftp  vsftpd 2.0.8 or later
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| -rwxrwxrwx Calendar.pptx [NSE: writeable]
| drwxrwxrwx Clients [NSE: writeable]
...
| ftp-syst:
|   STAT:
|   vsFTPd 3.0.3 - secure, fast, stable
```

**Reasoning Layer:**
Nmap NSE automates service fingerprinting and misconfiguration checks. Scripts like `ftp-anon` and `ftp-syst` quickly reveal anonymous access and server version.

---

#### Script Tracing

###### Trace NSE Execution

```bash
sudo nmap -sV -p21 -sC -A 10.129.14.136 --script-trace
```

Shows NSE script network-level interactions (`CONNECT`, `STAT`, etc.).

**Reasoning Layer:**
Script tracing verifies what commands are being sent. Useful for debugging scans or understanding how automation interacts with services.

---

#### Manual Service Interaction

###### Plaintext

```bash
nc -nv 10.129.14.136 21
telnet 10.129.14.136 21
```

###### Encrypted (TLS/SSL)

```bash
openssl s_client -connect 10.129.14.136:21 -starttls ftp
```

Sample Certificate Info:

```
CN = master.inlanefreight.htb
O = Inlanefreight
OU = Dev
emailAddress = admin@inlanefreight.htb
```

**Reasoning Layer:**
Direct interaction allows banner grabbing and testing of commands. SSL/TLS certificates can leak hostnames, org details, and even emails ‚Äî valuable OSINT data.

---

#### TFTP Enumeration

###### Download a File

```bash
tftp 10.129.14.136
tftp> get Important.txt

```

###### Upload a File

```bash
tftp> put shell.php

```

**Reasoning Layer:**
TFTP has no authentication, so file upload/download is often unrestricted. Misconfigured TFTP servers connected to web roots or configs can enable compromise.

---

#### Security Misconfigurations Identified

| Issue | Description | Impact |
| --- | --- | --- |
| Anonymous FTP login | Public access without credentials | Unauthorized data access |
| Recursive read | Full directory traversal | Data leakage |
| Write permissions | Upload possible in multiple dirs | Potential RCE / persistence |
| Plaintext communication | No encryption | Credential theft via sniffing |
| Self-signed TLS cert | Reveals internal hostnames/emails | OSINT / phishing leverage |

**Reasoning Layer:**
Summarizing misconfigurations highlights attack paths and remediation priorities.

---

#### Lessons Learned

- **FTP & TFTP are insecure by design** ‚Üí prefer SFTP/FTPS.
- **Misconfigurations (anon login, write perms)** are common and high-risk.
- **Automation (wget, NSE)** saves time and ensures coverage.
- **Certificates and banners** leak valuable intel.
- **Upload checks** are critical for identifying pivot opportunities.

---

#### üìå Quick Reference Commands

| Purpose | Command |
| --- | --- |
| Mirror FTP site | `wget -m --no-passive <ftp://anonymous:anonymous@IP`> |
| Upload file FTP | `ftp> put file.txt` |
| Download file FTP | `ftp> get file.txt` |
| Download file TFTP | `tftp> get file.txt` |
| Upload file TFTP | `tftp> put file.txt` |
| Nmap NSE FTP scan | `nmap -sV -p21 -sC -A IP` |
| Trace NSE | `nmap --script-trace -p21 -sC -A IP` |
| SSL handshake | `openssl s_client -connect IP:21 -starttls ftp` |

---

## 3.2. SMB & Samba

#### Overview of SMB

- **Server Message Block (SMB)**: Protocol for sharing files, directories, and network resources.
- Used in **Windows OS**, with **downward compatibility**.
- **Samba**: Open-source SMB implementation for Linux/Unix (supports SMB/CIFS).

###### Protocol & Connections

- SMB runs on **TCP** (3-way handshake).
- ACLs control permissions (read, write, execute).
- Shares = Arbitrary parts of filesystem exposed to clients.

---

#### Samba (SMB Dialect)

- Implements **CIFS (SMB v1 dialect)**.
- Ports:
    - **137,138,139** (NetBIOS over TCP/IP)
    - **445** (Direct SMB/CIFS)
- **SMB Versions:**
    - **CIFS / SMB 1.0**: Legacy, insecure.
    - **SMB 2.0 / 2.1**: Performance, caching, locking.
    - **SMB 3.0 / 3.1.1**: Encryption, integrity, AD integration.

###### Samba Daemons

- `smbd` ‚Üí Core SMB server daemon.
- `nmbd` ‚Üí NetBIOS daemon.
- Can act as **AD member** (v3) or **AD Domain Controller** (v4).

###### Workgroups & NetBIOS

- Workgroup = Collection of hosts/resources.
- NetBIOS handles **name registration** (via WINS).

---

#### Samba Configuration

- Config file: `/etc/samba/smb.conf`

###### Example Default Config

```
[global]
   workgroup = DEV.INFREIGHT.HTB
   server string = DEVSMB
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   server role = standalone server
   map to guest = bad user
   usershare allow guests = yes

[printers]
   path = /var/spool/samba
   printable = yes
   read only = yes

[print$]
   path = /var/lib/samba/printers
   read only = yes

```

###### Important Settings

- `workgroup` ‚Üí Domain/workgroup name.
- `path` ‚Üí Directory exposed.
- `map to guest = bad user` ‚Üí Redirect invalid users to guest.
- `guest ok = yes` ‚Üí Allows anonymous access.
- `browseable = yes` ‚Üí Makes share visible in list.
- `read only = no` / `writable = yes` ‚Üí File modification.
- `create mask` & `directory mask` ‚Üí File/dir permission defaults.

---

#### Dangerous Settings

- `browseable = yes` ‚Üí Attackers can list shares.
- `guest ok = yes` ‚Üí No password required.
- `writable = yes` ‚Üí File modification possible.
- `create mask = 0777` / `directory mask = 0777` ‚Üí Full access for all.

###### Example Insecure Share

```
[notes]
   comment = CheckIT
   path = /mnt/notes/
   browseable = yes
   read only = no
   writable = yes
   guest ok = yes
   enable privileges = yes
   create mask = 0777
   directory mask = 0777

```

---

#### Enumeration & Exploitation

###### Restart Samba

```bash
sudo systemctl restart smbd

```

###### SMBclient (Null Session / Anonymous)

```bash
smbclient -N -L //10.129.14.128

```

- Lists shares (default: `print$`, `IPC$`).

###### Connect to Share

```bash
smbclient //10.129.14.128/notes

```

- Anonymous login possible if `guest ok = yes`.

###### Useful smbclient Commands

- `ls` ‚Üí List files
- `get <file>` ‚Üí Download file
- `!<cmd>` ‚Üí Run local command

Example:

```bash
smb: \\> get prep-prod.txt
smb: \\> !cat prep-prod.txt

```

---

#### Admin Monitoring

```bash
smbstatus

```

- Shows active users, shares, and protocols.

---

#### Nmap Enumeration

```bash
sudo nmap 10.129.14.128 -sV -sC -p139,445

```

- Detects SMB version, signing, time.
- Limited ‚Üí use with manual tools.

---

#### Rpcclient (Manual Enumeration)

```bash
rpcclient -U "" 10.129.14.128

```

###### Rpcclient Commands

- `srvinfo` ‚Üí Server info
- `enumdomains` ‚Üí List domains
- `querydominfo` ‚Üí Domain & user info
- `netshareenumall` ‚Üí Enumerate shares
- `netsharegetinfo <share>` ‚Üí Share details
- `enumdomusers` ‚Üí List users
- `queryuser <RID>` ‚Üí User details

---

## Part 2 ‚Äì User & Group Enumeration

#### Rpcclient ‚Äì User Enumeration

```bash
rpcclient $> enumdomusers

```

- Example output:
    - `mrb3n` (RID: 0x3e8)
    - `cry0l1t3` (RID: 0x3e9)

###### Query User Details

```bash
rpcclient $> queryuser 0x3e9
rpcclient $> queryuser 0x3e8

```

---

#### Rpcclient ‚Äì Group Information

```bash
rpcclient $> querygroup 0x201

```

- Group: Ordinary Users (2 members).

---

#### RID Brute Forcing

```bash
for i in $(seq 500 1100); do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x' $i)" | grep "User Name\\|user_rid\\|group_rid" && echo "";done

```

- Discovered:
    - `sambauser` (RID: 0x1f5)
    - `mrb3n` (RID: 0x3e8)
    - `cry0l1t3` (RID: 0x3e9)

---

#### Impacket ‚Äì [samrdump.py](https://wadcoms.github.io/wadcoms/Impacket-SAMRDump/)

```bash
samrdump.py 10.129.14.128

```

- Enumerates domain users & attributes.
- Discovered: `mrb3n`, `cry0l1t3`.

---

#### SMBmap

```bash
smbmap -H 10.129.14.128

```

- Lists shares & permissions.

---

#### CrackMapExec

```bash
crackmapexec smb 10.129.14.128 --shares -u '' -p ''

```

- Detects OS version, enumerates shares & perms.
- Example: `notes` ‚Üí READ,WRITE.

---

#### Enum4Linux-ng

```bash
git clone <https://github.com/cddmp/enum4linux-ng.git>
cd enum4linux-ng
pip3 install -r requirements.txt
./enum4linux-ng.py 10.129.14.128 -A

```

- Automated enumeration.

###### Findings:

- Workgroup: `DEVOPS`
- Server: `DEVSMB`
- SMB Versions: 2.02, 2.1, 3.0 (SMB1 disabled)
- Users: `mrb3n`, `cry0l1t3`
- Shares: `notes`, `home`, `dev`, `print$`, `IPC$`
- Password Policy: Min length = 5, Complexity = disabled
- OS: Windows 7 / Server 2008 R2

---

#### Key Takeaways

- Null sessions are a major risk.
- Manual enumeration (`rpcclient`) + automated tools (SMBmap, CME, enum4linux-ng) give best coverage.
- Weak configs (`guest ok`, `writable`, `browseable`) lead to exploitation.

#### POC **Questions (SMB)**

1. What version of the SMB server is running on the target system? Submit the entire banner as the answer.

```bash
sudo nmap 10.129.57.34 -sV -sC -p137,138,139,445
```

Samba smbd 4.6.2

1. What is the name of the accessible share on the target?

```bash
smbmap -H 10.129.57.34
##or
crackmapexec smb 10.129.57.34 --shares -u '' -p ''
smbclient -N -L [//10.129.57.34](https://10.129.57.34/)
```

sambashare

1. Connect to the discovered share and find the flag.txt file. Submit the contents as the answer.

```bash
smbclient [//10.129.57.34/sambashare](https://10.129.57.34/sambashare)
smb: \> ls
.                                   D        0  Mon Nov  8 07:43:14 2021
..                                  D        0  Mon Nov  8 09:53:19 2021
.profile                            H      807  Tue Feb 25 06:03:22 2020
contents                            D        0  Mon Nov  8 07:43:45 2021
.bash_logout                        H      220  Tue Feb 25 06:03:22 2020
.bashrc                             H     3771  Tue Feb 25 06:03:22 2020
	4062912 blocks of size 1024. 414240 blocks available
	
smb: \> get contents
NT_STATUS_FILE_IS_A_DIRECTORY opening remote file \contents
smb: \> cd contents
smb: \contents\> ls
.                                   D        0  Mon Nov  8 07:43:45 2021
..                                  D        0  Mon Nov  8 07:43:14 2021
flag.txt                            N       38  Mon Nov  8 07:43:45 2021
	4062912 blocks of size 1024. 414236 blocks available
	
smb: \contents\> get flag.txt
getting file \contents\flag.txt of size 38 as flag.txt (1.9 KiloBytes/sec) (average 1.9 KiloBytes/sec)
smb: \contents\> !cat flag.txt
HTB{o873nz4xdo873n4zo873zn4fksuhldsf}
```

HTB{o873nz4xdo873n4zo873zn4fksuhldsf}

1.  Find out which domain the server belongs to.

```bash
enum4linux-ng 10.129.57.34 -A
```

DEVOPS

1. Find additional information about the specific share we found previously and submit the customized version of that specific share as the answer.

```bash
netsharegetinfo sambashare
```

InFreight SMB v3.1

1. What is the full system path of that specific share? (format: "/directory/names")

```bash
netsharegetinfo sambashare
```

/home/sambauser